<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜¤ë”ì¦ˆ - ë¹ ë¥¸ì£¼ë¬¸ (ì˜¨ë³´ë”© ì˜ˆì‹œ)</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        /* Noto Sans KR í°íŠ¸ import */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            overscroll-behavior-y: contain; /* ëª¨ë°”ì¼ ë‹¹ê²¨ì„œ ìƒˆë¡œê³ ì¹¨ ë°©ì§€ */
            -webkit-text-size-adjust: 100%; /* ëª¨ë°”ì¼ í°íŠ¸ í¬ê¸° ìë™ ì¡°ì ˆ ë°©ì§€ */
            text-size-adjust: 100%;
        }
        
        /* ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¸°ê¸° */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* í™œì„± íƒ­ ìŠ¤íƒ€ì¼ */
        .tab-active {
            border-bottom: 2px solid #28a745;
            color: #28a745;
            font-weight: 700;
        }
        .tab-inactive { color: #6c757d; }
        
        /* ìˆ˜ëŸ‰ ë²„íŠ¼ */
        .quantity-btn {
            width: 28px;
            height: 28px;
            line-height: 28px;
            text-align: center;
        }
        
        /* ì£¼ë¬¸ ë²„íŠ¼ ë¹„í™œì„± */
        .order-btn-disabled {
            background-color: #a0a00;
            cursor: not-allowed;
        }
        
        /* ì„ íƒëœ ìƒí’ˆ ë°°ê²½ìƒ‰ */
        .product-item-selected { background-color: #e9f5ff; }
        
        /* í¸ì§‘ ë·° í™œì„± í•„í„° */
        .edit-filter-btn.active {
            background-color: #28a745;
            color: white;
            border-color: #28a745;
        }
        
        /* ì°œ ë¶ˆê°€ ì•„ì´ì½˜ (FA 'ban' ì•„ì´ì½˜) */
        .like-disabled-icon::before {
            content: "\f05e"; /* fa-ban */
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            color: #cbd5e1; /* gray-300 */
        }

        /* --- Sticky í—¤ë” ë° ê²€ìƒ‰ì°½ ê´€ë ¨ ìŠ¤íƒ€ì¼ --- */
        
        #sub-header {
            position: sticky;
            top: 57px; /* í—¤ë”(57px) ë°”ë¡œ ì•„ë˜ ê³ ì • */
            z-index: 10;
            transition: transform 0.3s ease-in-out;
        }
        .sub-header-hidden { transform: translateY(-100%); }

        #search-container {
            transition: max-height 0.3s ease-in-out, padding 0.3s ease-in-out, opacity 0.3s ease-in-out, border 0.3s ease-in-out;
            overflow: hidden;
            max-height: 100px;
        }
        #search-container.search-hidden {
            max-height: 0;
            padding-top: 0 !important;
            padding-bottom: 0 !important;
            opacity: 0;
            border-bottom-width: 0 !important;
        }

        /* LIST 1 ì„¹ì…˜ í—¤ë” sticky */
        .list1-section-header-sticky {
            position: sticky;
            top: 96px; /* sub-header(39px) + sub-header.top(57px) */
            background-color: white;
            z-index: 5;
            padding-top: 0.5rem;
            padding-bottom: 0.25rem;
            border-bottom: 1px solid #e5e7eb;
        }

        /* ê²€ìƒ‰ ëª¨ë“œì¼ ë•Œ LIST 1 í—¤ë” ìœ„ì¹˜ ì¡°ì • */
        #app.search-mode-active .list1-section-header-sticky {
            top: 142px; /* ê¸°ì¡´ top(96px) + ê²€ìƒ‰ì°½ ë†’ì´(ì•½ 46px) */
        }
        
        /* --- ì£¼ë¬¸ í™•ì¸ í™”ë©´ í† ê¸€ ìŠ¤íƒ€ì¼ --- */
        .order-view-toggle-btn {
            flex: 1;
            padding: 0.5rem 0;
            font-size: 0.875rem;
            font-weight: 500;
            text-align: center;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }
        .order-view-toggle-btn.active {
            color: #28a745;
            font-weight: 700;
            border-bottom-color: #28a745;
        }
        .order-view-toggle-btn.inactive {
            color: #6c757d;
        }


        /* --- NEW: Onboarding Styles --- */
        #onboarding-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 998;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none; /* í´ë¦­ ë°©ì§€ */
        }
        #onboarding-overlay.active {
            opacity: 1;
            pointer-events: auto; /* í™œì„±í™” ì‹œ í´ë¦­ ê°€ëŠ¥ */
        }
        /* ë™ì˜ìƒ ëª¨ë‹¬ íŒì—… */
        #video-guide-modal {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            z-index: 1001;
            width: 90%;
            max-width: 400px; /* ìµœëŒ€ ë„ˆë¹„ */
            opacity: 0;
            transition: opacity 0.3s ease, transform 0.3s ease;
            pointer-events: none;
            display: none;
        }
        #video-guide-modal.active {
            display: block;
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
            pointer-events: auto;
        }
        #video-guide-modal video,
        #video-guide-modal img { /* ë¹„ë””ì˜¤ ë˜ëŠ” GIF */
            width: 100%;
            display: block;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
            background-color: #eee; /* ë¡œë”© ì¤‘ ë°°ê²½ìƒ‰ */
        }


        #onboarding-bottom-sheet {
            position: fixed;
            bottom: 0;
            left: 0; right: 0;
            max-width: 28rem; /* 448px (max-w-md) */
            margin: 0 auto;
            background-color: white;
            border-top-left-radius: 16px;
            border-top-right-radius: 16px;
            z-index: 999;
            transform: translateY(100%);
            transition: transform 0.3s ease-in-out;
            padding: 1.5rem;
            padding-bottom: 1rem;
            box-shadow: 0 -4px 12px rgba(0,0,0,0.1);
        }
        #onboarding-bottom-sheet.active {
            transform: translateY(0%);
        }
        /* í•˜ë‹¨ ì‹œíŠ¸ ë‹«ê¸° ë²„íŠ¼ (ìš°ì¸¡ ìƒë‹¨) */
        #onboarding-close-btn-top {
            position: absolute;
            top: 1rem;
            right: 1rem;
            color: #9ca3af; /* gray-400 */
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 99px;
            background-color: #f3f4f6; /* gray-100 */
        }

        .coach-mark {
            position: fixed;
            z-index: 1000;
            background-color: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            max-width: 260px;
            opacity: 0;
            transition: opacity 0.3s ease, transform 0.3s ease;
            pointer-events: none;
            display: none; /* JSë¡œ ì œì–´í•˜ê¸° ì „ ìˆ¨ê¹€ */
        }
        .coach-mark.active {
            opacity: 1;
            pointer-events: auto;
            display: block;
        }
        /* ë§í’ì„  ê¼¬ë¦¬ */
        .coach-mark::after {
            content: '';
            position: absolute;
            width: 0; height: 0;
            border-style: solid;
            bottom: 100%; /* ê¼¬ë¦¬ê°€ ìœ„ë¥¼ í–¥í•˜ë„ë¡ */
            left: 30px; /* ê¸°ë³¸ê°’ */
            border-width: 0 8px 10px 8px;
            border-color: transparent transparent white transparent;
        }
        /* ì½”ì¹˜ë§ˆí¬ 3ë²ˆ(í¸ì§‘)ì€ ê¼¬ë¦¬ë¥¼ ì˜¤ë¥¸ìª½ìœ¼ë¡œ */
        #coach-mark-3::after {
            left: auto;
            right: 30px;
        }
        /* --- End Onboarding Styles --- */

    </style>
</head>
<body class="bg-gray-50">

    <div id="app" class="max-w-md mx-auto bg-white shadow-lg min-h-screen">

        <!-- =======================
            HOME VIEW
        ======================== -->
        <div id="home-view">
             <!-- í™ˆ ë·° í—¤ë” (íƒ€ì´í‹€ + ì¹´í…Œê³ ë¦¬) -->
             <header class="sticky top-0 bg-white z-20 shadow-sm">
                <!-- 1ë‹¨: íƒ€ì´í‹€ -->
                <div class="flex justify-between items-center p-3 border-b">
                    <div class="flex items-center space-x-3">
                        <i class="fas fa-bars text-xl"></i>
                    </div>
                    <h1 id="logo-home" class="text-2xl font-extrabold text-green-600 cursor-pointer">ì˜¤ë”ì¦ˆ</h1>
                    <div class="flex items-center space-x-2">
                        <span class="text-xs font-semibold">OP</span>
                        <i class="fas fa-user-circle text-2xl text-gray-400"></i>
                    </div>
                </div>

                <!-- 2ë‹¨: í™ˆ ë·° ì¹´í…Œê³ ë¦¬ (ìœ ì§€) -->
                <nav class="flex justify-around items-center p-2">
                    <button class="flex flex-col items-center space-y-1 text-gray-600"><i class="fas fa-carrot text-xl text-orange-400"></i><span class="text-xs font-medium">ì±„ì†Œ/ê³¼ì¼</span></button>
                    <button class="flex flex-col items-center space-y-1 text-gray-600"><i class="fas fa-fish text-xl text-blue-400"></i><span class="text-xs font-medium">ìˆ˜ì‚°/ì¶•ì‚°</span></button>
                    <button class="flex flex-col items-center space-y-1 text-gray-600"><i class="fas fa-snowflake text-xl text-cyan-400"></i><span class="text-xs font-medium">ì‹í’ˆ/ê°€ê³µ</span></button>
                    <button class="flex flex-col items-center space-y-1 text-gray-600"><i class="fas fa-bottle-droplet text-xl text-yellow-500"></i><span class="text-xs font-medium">ì–‘ë…/ì†ŒìŠ¤</span></button>
                    <button class="flex flex-col items-center space-y-1 text-gray-600"><i class="fas fa-utensils text-xl text-gray-500"></i><span class="text-xs font-medium">ì£¼ë°©/ì¡í™”</span></button>
                </nav>
            </header>
            <main class="pb-24">
                 <!-- í™ˆ ë·° ì„œë¸Œí—¤ë” -->
                 <div class="flex justify-around items-center px-4 py-2 border-b bg-white sticky top-[117px] z-10">
                    <button class="py-2 text-sm font-semibold border-b-2 border-green-500 text-green-500">íƒ€ì„ì„¸ì¼</button>
                    <button class="py-2 text-sm text-gray-500">ê²½ë§¤ìƒí’ˆ</button>
                    <button class="py-2 text-sm text-gray-500">í• ì¸ìƒí’ˆ</button>
                    <button class="py-2 text-sm text-gray-500">ë§ˆê°ì„ë°•</button>
                 </div>
                 <!-- í™ˆ ë·° ìƒí’ˆ ëª©ë¡ -->
                 <div id="home-product-list" class="divide-y">
                     <!-- JS ë Œë”ë§ -->
                 </div>
            </main>
        </div>


        <!-- =======================
            QUICK ORDER VIEW
        ======================== -->
        <div id="quick-order-view" class="hidden">

            <!-- ë¹ ë¥¸ì£¼ë¬¸ í—¤ë” (ì¹´í…Œê³ ë¦¬ë°” ì œê±°ë¨) -->
            <header class="sticky top-0 bg-white z-20 shadow-sm">
                <!-- 1ë‹¨: íƒ€ì´í‹€ -->
                <div class="flex justify-between items-center p-3 border-b">
                    <div class="flex items-center space-x-3">
                        <i class="fas fa-bars text-xl"></i>
                    </div>
                    <h1 id="logo-quick-order" class="text-2xl font-extrabold text-green-600 cursor-pointer">ë¹ ë¥¸ ì£¼ë¬¸</h1>
                    <div class="flex items-center space-x-2">
                        <span class="text-xs font-semibold">OP</span>
                        <i class="fas fa-user-circle text-2xl text-gray-400"></i>
                    </div>
                </div>
            </header>

            <!-- ë¹ ë¥¸ì£¼ë¬¸ ë©”ì¸ -->
            <main class="pb-40">

                <!-- ì„œë¸Œí—¤ë” (íƒ­ + ê²€ìƒ‰) -->
                <div id="sub-header" class="z-10 shadow-md bg-gray-100">
                    <!-- íƒ­ + ê²€ìƒ‰ ë²„íŠ¼ + í¸ì§‘ ë²„íŠ¼ -->
                    <div id="my-list-container" class="flex justify-between items-center px-4 py-3 border-b bg-white">
                        <!-- ê²€ìƒ‰ ë²„íŠ¼ -->
                        <button id="show-search-btn" class="flex-shrink-0 mr-3 p-1.5 rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200">
                            <i class="fas fa-search text-sm w-4 h-4"></i>
                        </button>
                        <!-- MY LIST íƒ­ -->
                        <div id="my-list-tabs" class="flex flex-1 justify-around overflow-x-auto no-scrollbar">
                             <button data-list="0" class="my-list-tab py-2 tab-active flex-shrink-0 text-sm">ë‹¨ê³¨íŠ¹ê°€</button>
                             <button data-list="1" class="my-list-tab py-2 tab-inactive flex-shrink-0 text-sm">LIST 1</button>
                             <button data-list="2" class="my-list-tab py-2 tab-inactive flex-shrink-0 text-sm">LIST 2</button>
                             <button data-list="3" class="my-list-tab py-2 tab-inactive flex-shrink-0 text-sm">LIST 3</button>
                        </div>
                        <!-- í¸ì§‘ ë²„íŠ¼ -->
                        <button id="edit-button" class="text-gray-500 flex-shrink-0 ml-4 p-1">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75" />
                            </svg>
                        </button>
                    </div>

                    <!-- ê²€ìƒ‰ ì…ë ¥ì°½ (ìˆ¨ê²¨ì§) -->
                    <div id="search-container" class="p-2 border-b bg-white search-hidden">
                        <div class="flex items-center w-full">
                            <div class="relative flex-grow">
                                <input type="text" id="product-search-input" placeholder="í˜„ì¬ íƒ­ ìƒí’ˆ ê²€ìƒ‰" class="w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-sm">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <i class="fas fa-search text-gray-400"></i>
                                </div>
                            </div>
                            <!-- ê²€ìƒ‰ ì·¨ì†Œ ë²„íŠ¼ -->
                            <button id="cancel-search-btn" class="flex-shrink-0 ml-3 text-sm text-gray-600 font-medium px-2">ì·¨ì†Œ</button>
                        </div>
                    </div>
                </div>

                <!-- ìƒí’ˆ ëª©ë¡ -->
                <div id="product-list-container" class="px-4 mt-2">
                    <div id="product-list" class="space-y-2">
                        <!-- JS ë Œë”ë§ -->
                    </div>
                </div>

                <!-- ì£¼ë¬¸ í™•ì¸ ëª©ë¡ (ìˆ¨ê²¨ì§) -->
                <div id="order-confirmation-container" class="hidden px-4 mt-2">
                    <!-- ì œëª© ë° ê°œìˆ˜ -->
                    <div class="flex justify-between items-center my-4">
                        <h2 class="text-lg font-bold">ë‹´ì€ ìƒí’ˆ í™•ì¸</h2>
                        <span id="confirmation-total-count" class="text-base font-bold text-green-600"></span>
                    </div>
                    <!-- ë¶„ë¥˜ í† ê¸€ ë²„íŠ¼ -->
                    <div id="order-view-toggle" class="flex border-b border-gray-200 mb-3">
                        <button data-mode="category" class="order-view-toggle-btn active">ì¹´í…Œê³ ë¦¬ë³„</button>
                        <button data-mode="list" class="order-view-toggle-btn inactive">ë¦¬ìŠ¤íŠ¸ë³„</button>
                    </div>
                    <!-- ì£¼ë¬¸ í™•ì¸ ë¦¬ìŠ¤íŠ¸ -->
                    <div id="confirmation-list" class="space-y-4">
                        <!-- JS ë Œë”ë§ -->
                    </div>
                </div>
            </main>
        </div>

        <!-- =======================
            EDIT VIEW
        ======================== -->
        <div id="edit-view" class="hidden">
            <header class="sticky top-0 bg-white z-20 shadow-sm p-3">
                 <!-- í¸ì§‘ ë·° í—¤ë” -->
                 <div class="flex justify-between items-center border-b pb-3">
                    <div class="flex items-center space-x-3">
                        <i class="fas fa-bars text-xl"></i>
                    </div>
                    <h1 class="text-2xl font-extrabold text-green-600">ì˜¤ë”ì¦ˆ</h1>
                    <div class="flex items-center space-x-2">
                        <span class="text-sm font-semibold">25,400P</span>
                        <i class="fas fa-user-circle text-2xl text-gray-400"></i>
                    </div>
                </div>
                <!-- í¸ì§‘ ë·° í•„í„° -->
                <div id="edit-filter-menu" class="grid grid-cols-5 gap-2 pt-3">
                    <button data-filter="null" class="edit-filter-btn py-2 border rounded-md text-sm font-semibold active">ì „ì²´</button>
                    <button data-filter="1" class="edit-filter-btn py-2 border rounded-md text-sm font-semibold">LIST 1</button>
                    <button data-filter="2" class="edit-filter-btn py-2 border rounded-md text-sm font-semibold">LIST 2</button>
                    <button data-filter="3" class="edit-filter-btn py-2 border rounded-md text-sm font-semibold">LIST 3</button>
                    <button id="save-button" class="py-2 border rounded-md text-sm font-semibold bg-green-500 text-white">ì €ì¥í•˜ê¸°</button>
                </div>
            </header>
            <main class="pb-5">
                 <!-- í¸ì§‘ ë·° ëª©ë¡ -->
                 <div id="edit-list" class="divide-y">
                     <!-- JS ë Œë”ë§ -->
                 </div>
            </main>
        </div>

        <!-- =======================
            FOOTER
        ======================== -->
        <footer class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white border-t z-20">

            <!-- ì£¼ë¬¸ ë°” (ìˆ¨ê²¨ì§) -->
            <div id="order-bar" class="flex items-center justify-between p-3 hidden">
                <div>
                    <p class="text-xs text-gray-500">ë°°ì†¡ì˜ˆì •ì¼</p>
                    <p class="font-bold text-blue-600">2025-10-20</p>
                </div>
                <button id="order-button" class="w-2/3 py-3 rounded-lg text-white font-bold flex items-center justify-center space-x-2 order-btn-disabled">
                    <span id="order-bubble" class="bg-yellow-400 text-green-800 text-xs font-bold w-5 h-5 rounded-full flex items-center justify-center hidden">0</span>
                    <span id="order-button-text">ì£¼ë¬¸í•  ìƒí’ˆì„ ë‹´ì•„ì£¼ì„¸ìš”</span>
                </button>
            </div>

            <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
            <nav id="bottom-nav" class="flex justify-around items-center py-2 text-gray-500 border-t">
                 <a href="#" id="home-nav-btn" class="flex flex-col items-center space-y-1 text-green-500">
                    <i class="fas fa-home text-xl"></i>
                    <span class="text-xs font-bold">í™ˆ</span>
                </a>
                 <a href="#" class="flex flex-col items-center space-y-1">
                    <i class="fas fa-search text-xl"></i>
                    <span class="text-xs">ê²€ìƒ‰</span>
                </a>
                 <a href="#" id="quick-order-nav-btn" class="flex flex-col items-center space-y-1">
                    <div class="relative">
                        <i class="fas fa-check-square text-2xl"></i>
                        <span id="nav-badge" class="absolute -top-1 -right-2 bg-red-500 text-white text-[10px] font-bold w-4 h-4 rounded-full flex items-center justify-center">0</span>
                    </div>
                    <span class="text-xs">ë¹ ë¥¸ì£¼ë¬¸</span>
                </a>
                 <a href="#" class="flex flex-col items-center space-y-1">
                    <i class="fas fa-comment-dots text-xl"></i>
                     <span class="text-xs">ì±„íŒ…</span>
                </a>
            </nav>
        </footer>

    </div>

    <!-- =======================
        NEW: ONBOARDING ELEMENTS
        (ìƒˆë¡œìš´ ê¸°ëŠ¥ ì˜¨ë³´ë”© ì•ˆë‚´ UI)
    ======================== -->
    <div id="onboarding-overlay"></div>

    <!-- 1. ë™ì˜ìƒ/GIF ê°€ì´ë“œ ëª¨ë‹¬ (NEW) -->
    <div id="video-guide-modal">
        <div class="p-4 border-b flex justify-between items-center">
            <h4 class="font-bold text-lg text-green-600">ğŸš€ ë¹ ë¥¸ì£¼ë¬¸ í•µì‹¬ ê°€ì´ë“œ</h4>
            <button id="video-modal-close-btn" class="text-gray-400 hover:text-gray-600 w-6 h-6">
                <i class="fas fa-times fa-lg"></i>
            </button>
        </div>
        <!-- 
          Guidde ë“±ìœ¼ë¡œ ì œì‘í•œ ë™ì˜ìƒì´ë‚˜ GIFë¥¼ ì—¬ê¸°ì— ë„£ìŠµë‹ˆë‹¤.
          - GIF ì¶”ì²œ: <img src="ì—¬ê¸°ì—_ê°€ì´ë“œ_GIF_URL.gif" alt="ë¹ ë¥¸ì£¼ë¬¸ ê°€ì´ë“œ">
          - ë™ì˜ìƒ ì¶”ì²œ: <video src="ì—¬ê¸°ì—_ê°€ì´ë“œ_MP4_URL.mp4" autoplay loop muted playsinline></video>
        -->
        <img src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExM3h0eTlsbHJ0eGhkYjN1eGY1a3hpN3NtcWJqZGFvYmN5cDR0bHE2ayZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/lqznM4Eks6xOM/giphy.gif" alt="ê°€ì´ë“œ GIF ì˜ˆì‹œ" class="w-full">
        <div class="p-4 bg-gray-50 text-center">
            <p class="text-sm text-gray-700">í•µì‹¬ ê¸°ëŠ¥: â‘  ë‹¨ê³¨íŠ¹ê°€ â‘¡ ìŠ¤ì™€ì´í”„ â‘¢ ë¦¬ìŠ¤íŠ¸ í¸ì§‘</p>
        </div>
    </div>

    <!-- 2. í•˜ë‹¨ ì‹œíŠ¸ íŒì—… -->
    <div id="onboarding-bottom-sheet">
        <button id="onboarding-close-btn-top">
            <i class="fas fa-times"></i>
        </button>
        <h3 class="text-xl font-bold mb-3">ğŸš€ 'ë¹ ë¥¸ì£¼ë¬¸'ì´ ë” ìŠ¤ë§ˆíŠ¸í•´ì¡Œì–´ìš”!</h3>
        <p class="text-sm text-gray-700 mb-4">ì–´ë–»ê²Œ ë‘˜ëŸ¬ë³´ì‹œê² ì–´ìš”?</p>
        
        <!-- ë²„íŠ¼ ë ˆì´ì•„ì›ƒ ë³€ê²½ -->
        <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-3">
            <button id="onboarding-watch-video-btn" class="w-full py-3 rounded-lg text-green-600 bg-green-100 font-bold text-sm flex items-center justify-center">
                <i class="fas fa-play-circle mr-2"></i> 30ì´ˆ ì˜ìƒ ê°€ì´ë“œ
            </button>
            <button id="onboarding-start-tour-btn" class="w-full py-3 rounded-lg bg-green-500 text-white font-bold text-sm flex items-center justify-center">
                <i class="fas fa-mouse-pointer mr-2"></i> ì§ì ‘ ë‘˜ëŸ¬ë³´ê¸°
            </button>
        </div>

        <ul class="space-y-2 mb-6 mt-6 text-xs text-gray-600 hidden">
            <!-- ìš”ì•½ ë¦¬ìŠ¤íŠ¸ëŠ” ìˆ¨ê¹€ ì²˜ë¦¬ (ë²„íŠ¼ì´ ë” ì¤‘ìš”) -->
            <li><span class="font-semibold text-green-600">â‘  [ë‹¨ê³¨íŠ¹ê°€]</span> : 'ì°œ' ê¸°ë°˜ íŠ¹ê°€ ìë™ ì¶”ì²œ</li>
            <li><span class="font-semibold text-green-600">â‘¡ [ìŠ¤ì™€ì´í”„]</span> : íƒ­ì„ ë°€ì–´ì„œ ë¹ ë¥¸ ì´ë™</li>
            <li><span class="font-semibold text-green-600">â‘¢ [ë¦¬ìŠ¤íŠ¸ í¸ì§‘]</span> : ì°œ ëª©ë¡ì„ 1,2,3ìœ¼ë¡œ ë¶„ë¥˜</li>
        </ul>
    </div>

    <!-- 3. ì½”ì¹˜ ë§ˆí¬ (ê¸°ëŠ¥ ìœ„ì¹˜ë³„ ë§í’ì„  ì•ˆë‚´) -->
    <div id="coach-mark-container">
        <!-- Step 1: Dangol Teukka (ë‹¨ê³¨íŠ¹ê°€) -->
        <div id="coach-mark-1" class="coach-mark">
            <h4 class="font-bold text-green-600">NEW! ì°œ ê¸°ë°˜ ë§ì¶¤ íŠ¹ê°€</h4>
            <p class="text-sm text-gray-700 mt-1 mb-3">'ì°œ'í•œ ìƒí’ˆê³¼ ì—°ê´€ëœ íŠ¹ê°€ ìƒí’ˆì´ ìë™ìœ¼ë¡œ ëª¨ì…ë‹ˆë‹¤.</p>
            <button id="coach-mark-next-1" class="w-full py-2 bg-green-500 text-white text-sm rounded-md font-bold">ë‹¤ìŒ</button>
        </div>
        <!-- Step 2: Swipe (ìŠ¤ì™€ì´í”„) -->
        <div id="coach-mark-2" class="coach-mark">
            <h4 class="font-bold text-green-600">ì¢Œìš°ë¡œ ìŠ¤ì™€ì´í”„ &lt;-&gt; í•˜ì„¸ìš”</h4>
            <p class="text-sm text-gray-700 mt-1 mb-3">íƒ­ì„ ì†ê°€ë½ìœ¼ë¡œ ë°€ì–´ì„œ ë¦¬ìŠ¤íŠ¸ë¥¼ ë¹ ë¥´ê²Œ ë„˜ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            <button id="coach-mark-next-2" class="w-full py-2 bg-green-500 text-white text-sm rounded-md font-bold">ë‹¤ìŒ</button>
        </div>
        <!-- Step 3: Edit Button (í¸ì§‘ ë²„íŠ¼) -->
        <div id="coach-mark-3" class="coach-mark">
            <h4 class="font-bold text-green-600">ì°œ ìƒí’ˆ ê´€ë¦¬</h4>
            <p class="text-sm text-gray-700 mt-1 mb-3">ì—¬ê¸°ì„œ 'ì°œ' ìƒí’ˆì„ 1, 2, 3 ë¦¬ìŠ¤íŠ¸ë¡œ ë¶„ë¥˜í•˜ì„¸ìš”!</p>
            <button id="coach-mark-done" class="w-full py-2 bg-green-500 text-white text-sm rounded-md font-bold">í™•ì¸</button>
        </div>
    </div>
    <!-- === END NEW ONBOARDING ELEMENTS === -->


<script>
    document.addEventListener('DOMContentLoaded', function() {
        
        // --- DATA ---
        // (ê¸°ì¡´ ë°ì´í„°... ìƒëµ)
        const appState = {
            products: {
                vegetable: [
                    { id: 100, name: 'ë¬´ìš°_íŠ¹ë°•ìŠ¤_10ì…', spec: 'BOX', price: 9500, category: 'vegetable', subCategory: 'ë¬´/ë°°ì¶”/ì¡°ë¯¸ì±„ì†Œ', thirdCategory: 'ë¬´ìš°', liked: false, myList: [], isEvent: true, deliveryDate: '2025-10-21', likedTimestamp: null, allowLike: true },
                    { id: 101, name: 'ë¬´ìš°_ë‚±ê°œ', spec: 'ì†Œë¶„', price: 1400, category: 'vegetable', subCategory: 'ë¬´/ë°°ì¶”/ì¡°ë¯¸ì±„ì†Œ', thirdCategory: 'ë¬´ìš°', liked: false, myList: [], isEvent: true, deliveryDate: '2025-10-22', likedTimestamp: null, allowLike: false },
                    { id: 102, name: 'ë¬´ìš°2_ì‘ì€ë¬´', spec: 'BOX', price: 8900, category: 'vegetable', subCategory: 'ë¬´/ë°°ì¶”/ì¡°ë¯¸ì±„ì†Œ', thirdCategory: 'ë¬´ìš°', liked: false, myList: [], isEvent: false, deliveryDate: '2025-10-21', likedTimestamp: null, allowLike: true },
                    { id: 103, name: 'ì–‘ë°°ì¶”40ë§_3ì…', spec: 'BOX', price: 6200, category: 'vegetable', subCategory: 'ë¬´/ë°°ì¶”/ì¡°ë¯¸ì±„ì†Œ', thirdCategory: 'ì–‘ë°°ì¶”', liked: false, myList: [], isEvent: true, deliveryDate: '2025-10-23', likedTimestamp: null, allowLike: false },
                    { id: 104, name: 'ì–‘ë°°ì¶”_ëŒ€_4ì…', spec: 'BOX', price: 8900, category: 'vegetable', subCategory: 'ë¬´/ë°°ì¶”/ì¡°ë¯¸ì±„ì†Œ', thirdCategory: 'ì–‘ë°°ì¶”', liked: false, myList: [], isEvent: false, deliveryDate: '2025-10-21', likedTimestamp: null, allowLike: true },
                    { id: 105, name: 'ì–‘íŒŒ_ì™•20kgë§', spec: 'BOX', price: 27800, category: 'vegetable', subCategory: 'ë¬´/ë°°ì¶”/ì¡°ë¯¸ì±„ì†Œ', thirdCategory: 'ì–‘íŒŒ', liked: false, myList: [], isEvent: true, deliveryDate: '2025-10-22', likedTimestamp: null, allowLike: true },
                    { id: 1, name: 'í™ìª½íŒŒ(1kg)ë‹¨', spec: 'íŒë§¤ì²˜: Bìœ í†µ', price: 9800, img: 'https://placehold.co/80x80/d1e7dd/333333?text=ìª½íŒŒ', category: 'vegetable', subCategory: 'ë¬´/ë°°ì¶”/ì¡°ë¯¸ì±„ì†Œ', thirdCategory: 'ìª½íŒŒ', liked: true, myList: [], deliveryDate: '2025-10-21', likedTimestamp: 1729770000000, allowLike: true },
                    { id: 2, name: 'ê¹ì–‘íŒŒ_10kg', spec: 'íŒë§¤ì²˜: Bìœ í†µ', price: 19500, img: 'https://placehold.co/80x80/d1e7dd/333333?text=ì–‘íŒŒ', category: 'vegetable', subCategory: 'ë¬´/ë°°ì¶”/ì¡°ë¯¸ì±„ì†Œ', thirdCategory: 'ì–‘íŒŒ', liked: false, myList: [], deliveryDate: '2025-10-22', likedTimestamp: null, allowLike: true },
                    { id: 3, name: 'ë¬´ìš° (ë‚±ê°œ)', spec: 'íŒë§¤ì²˜: Bìœ í†µ', price: 2800, img: 'https://placehold.co/80x80/d1e7dd/333333?text=ë¬´', category: 'vegetable', subCategory: 'ë¬´/ë°°ì¶”/ì¡°ë¯¸ì±„ì†Œ', thirdCategory: 'ë¬´ìš°', liked: true, myList: [], deliveryDate: '2025-10-25', likedTimestamp: 1729770001000, allowLike: true },
                    { id: 8, name: 'ê¹»ì/ìŒˆì±„/ìƒëŸ¬ë“œìš©', spec: 'íŒë§¤ì²˜: Cìœ í†µ', price: 4500, img: 'https://placehold.co/80x80/d1e7dd/333333?text=ê¹»ì', category: 'vegetable', subCategory: 'ê¹»ì/ìŒˆì±„/ìƒëŸ¬ë“œìš©', thirdCategory: 'ê¹»ì', liked: true, myList: [], deliveryDate: '2025-10-21', likedTimestamp: 1729770002000, allowLike: true },
                    { id: 9, name: 'ë°”ë‚˜ë‚˜/ë ˆëª¬/ìˆ˜ì…', spec: 'íŒë§¤ì²˜: Dìœ í†µ', price: 12000, img: 'https://placehold.co/80x80/d1e7dd/333333?text=ë°”ë‚˜ë‚˜', category: 'vegetable', subCategory: 'ë°”ë‚˜ë‚˜/ë ˆëª¬/ìˆ˜ì…/ëƒ‰ë™ê³¼ì¼', thirdCategory: 'ìˆ˜ì…ê³¼ì¼', liked: true, myList: [], deliveryDate: '2025-10-21', likedTimestamp: 1729770003000, allowLike: true },
                    { id: 10, name: 'êµ­ë‚´ì‚° ëŒ€íŒŒ 1kg', spec: 'íŒë§¤ì²˜: Aìœ í†µ', price: 3500, img: 'https://placehold.co/80x80/d1e7dd/333333?text=ëŒ€íŒŒ', category: 'vegetable', subCategory: 'ë¬´/ë°°ì¶”/ì¡°ë¯¸ì±„ì†Œ', thirdCategory: 'ëŒ€íŒŒ', liked: true, myList: [], deliveryDate: '2025-10-22', likedTimestamp: 1729770004000, allowLike: true },
                    { id: 11, name: 'ê¹ë§ˆëŠ˜ 500g', spec: 'íŒë§¤ì²˜: Aìœ í†µ', price: 6000, img: 'https://placehold.co/80x80/d1e7dd/333333?text=ë§ˆëŠ˜', category: 'vegetable', subCategory: 'ë¬´/ë°°ì¶”/ì¡°ë¯¸ì±„ì†Œ', thirdCategory: 'ë§ˆëŠ˜', liked: true, myList: [], deliveryDate: '2025-10-23', likedTimestamp: 1729770005000, allowLike: true },
                    { id: 12, name: 'ë°±ë‹¤ë‹¤ê¸°_5ê°œì…', price: 3500, spec: 'íŒë§¤ì²˜: Aë†ì‚°', category: 'vegetable', subCategory: 'ì˜¤ì´/í˜¸ë°•/ê³ ì¶”/í”¼ë§', thirdCategory: 'ì˜¤ì´', myList: [1], liked: true, deliveryDate: '2025-10-22', likedTimestamp: 1729770006000, allowLike: true },
                    { id: 13, name: 'ë¬´ìš°(ë‚±ê°œ)', price: 2400, spec: 'íŒë§¤ì²˜: Aë†ì‚°', category: 'vegetable', subCategory: 'ë¬´/ë°°ì¶”/ì¡°ë¯¸ì±„ì†Œ', thirdCategory: 'ë¬´ìš°', myList: [1], liked: true, deliveryDate: '2025-10-21', likedTimestamp: 1729770007000, allowLike: true },
                    { id: 14, name: 'ì–‘ë°°ì¶”(ëŒ€)(ë‚±ê°œ)', price: 3100, spec: 'íŒë§¤ì²˜: Bë†ì‚°', category: 'vegetable', subCategory: 'ë¬´/ë°°ì¶”/ì¡°ë¯¸ì±„ì†Œ', thirdCategory: 'ì–‘ë°°ì¶”', myList: [1], liked: true, deliveryDate: '2025-10-21', likedTimestamp: 1729770008000, allowLike: true },
                    { id: 15, name: 'ì–‘íŒŒ(3kg)', price: 6000, spec: 'íŒë§¤ì²˜: Cë†ì‚°', category: 'vegetable', subCategory: 'ë¬´/ë°°ì¶”/ì¡°ë¯¸ì±„ì†Œ', thirdCategory: 'ì–‘íŒŒ', myList: [1], liked: true, deliveryDate: '2025-10-22', likedTimestamp: 1729770009000, allowLike: true },
                    { id: 16, name: 'ê¹ì–‘íŒŒ_kg', price: 2600, spec: 'íŒë§¤ì²˜: Cë†ì‚°', category: 'vegetable', subCategory: 'ë¬´/ë°°ì¶”/ì¡°ë¯¸ì±„ì†Œ', thirdCategory: 'ì–‘íŒŒ', myList: [1], liked: true, deliveryDate: '2025-10-22', likedTimestamp: 1729770010000, allowLike: true },
                ],
                seafood: [
                    { id: 4, name: 'ë‘ì ˆê±´ìƒˆìš°_ì†Œ500g_ìˆ˜ì…', spec: 'íŒë§¤ì²˜: Bìœ í†µ', price: 7700, img: 'https://placehold.co/80x80/a2d2ff/333333?text=ìƒˆìš°', category: 'seafood', subCategory: 'ê±´ì–´ë¬¼', thirdCategory: 'ê±´ìƒˆìš°', liked: true, myList: [], deliveryDate: '2025-10-21', likedTimestamp: 1729770029000, allowLike: true },
                    { id: 52, name: 'ë² ì´ì»¨(ì•Œì°¬)', price: 11500, spec: 'íŒë§¤ì²˜: ì•Œì°¬', category: 'seafood', subCategory: 'ë¼ì§€ê³ ê¸°', thirdCategory: 'ê°€ê³µìœ¡', myList: [2], liked: true, deliveryDate: '2025-10-21', likedTimestamp: 1729770039000, allowLike: true },
                    { id: 200, name: 'ëƒ‰ë™ ê³ ë“±ì–´ 1kg', spec: 'íŒë§¤ì²˜: ìˆ˜ì‚°ë§ˆì¼“', price: 8500, img: 'https://placehold.co/80x80/a2d2ff/333333?text=ê³ ë“±ì–´', category: 'seafood', subCategory: 'ìƒì„ ', thirdCategory: 'ê³ ë“±ì–´', liked: false, myList: [], isEvent: true, deliveryDate: '2025-10-21', likedTimestamp: null, allowLike: true },
                ],
                processed: [
                    { id: 7, name: 'ê°“ê¹€ì¹˜_ì–¼ìŒê³¨_10kg', spec: 'íŒë§¤ì²˜: Bìœ í†µ', price: 58800, img: 'https://placehold.co/80x80/27ae60/ffffff?text=ê°“ê¹€ì¹˜', category: 'processed', subCategory: 'ê¹€ì¹˜/ë°˜ì°¬', thirdCategory: 'ê¹€ì¹˜', liked: false, myList: [], deliveryDate: '2025-10-24', likedTimestamp: null, allowLike: true },
                    { id: 51, name: 'ë¹µê°€ë£¨ìƒˆìš°10ë¯¸(í°ë°”ë‹¤/ë² íŠ¸ë‚¨)', price: 3200, spec: 'íŒë§¤ì²˜: í°ë°”ë‹¤', category: 'processed', subCategory: 'ëƒ‰ë™/ê°„í¸ì‹', thirdCategory: 'íŠ€ê¹€ë¥˜', myList: [2], liked: true, deliveryDate: '2025-10-23', likedTimestamp: 1729770047000, allowLike: true },
                ],
                sauce: [
                    { id: 63, name: 'ì‹ìš©ìœ (ë§)ì‰í”„ì›', price: 47800, spec: 'íŒë§¤ì²˜: ì‰í”„ì›', category: 'sauce', subCategory: 'ê¸°ë¦„', thirdCategory: 'ì‹ìš©ìœ ', myList: [3], liked: true, deliveryDate: '2025-10-22', likedTimestamp: 1729770067000, allowLike: true },
                ],
                kitchen: [
                    { id: 5, name: 'ì• ê²½ë¶€ë¼ë³´_íí_13kg_ë§', spec: 'íŒë§¤ì²˜: Bìœ í†µ', price: 15000, img: 'https://placehold.co/80x80/f8c471/333333?text=íí', category: 'kitchen', subCategory: 'ì„¸ì œ/ì²­ì†Œ', thirdCategory: 'ì£¼ë°©ì„¸ì œ', liked: true, myList: [], deliveryDate: '2025-10-23', likedTimestamp: 1729770079000, allowLike: true },
                ],
            },
            cart: {}, // { productId: quantity } (ìˆ˜ëŸ‰ ì…ë ¥ëœ ì°œ ìƒí’ˆ ëª©ë¡)
            currentView: 'home', // 'home', 'quick-order', 'edit'
            currentMyList: 0, // 0 for ë‹¨ê³¨íŠ¹ê°€, 1, 2, 3 for MY LIST
            editListFilter: null,
            searchTerm: '',
            isSearching: false, // ê²€ìƒ‰ ëª¨ë“œ ìƒíƒœ
            orderViewMode: 'category', // 'category' or 'list'
        };

        // --- ELEMENTS ---
        const appContainer = document.getElementById('app');
        const homeView = document.getElementById('home-view');
        const quickOrderView = document.getElementById('quick-order-view');
        const editView = document.getElementById('edit-view');

        // Quick Order View Elements
        const productListEl = document.getElementById('product-list');
        const orderButton = document.getElementById('order-button');
        const orderButtonText = document.getElementById('order-button-text');
        const orderBubble = document.getElementById('order-bubble');
        const productListContainer = document.getElementById('product-list-container');
        const orderConfirmationContainer = document.getElementById('order-confirmation-container');
        const confirmationListEl = document.getElementById('confirmation-list');
        const orderViewToggle = document.getElementById('order-view-toggle'); // ì£¼ë¬¸ í™•ì¸ í† ê¸€
        const myListTabsContainer = document.getElementById('my-list-tabs');
        const productSearchInput = document.getElementById('product-search-input');
        const searchContainer = document.getElementById('search-container');
        const showSearchBtn = document.getElementById('show-search-btn');
        const cancelSearchBtn = document.getElementById('cancel-search-btn');

        // Home View Elements
        const homeProductListEl = document.getElementById('home-product-list');

        // Edit View Elements
        const editButton = document.getElementById('edit-button');
        const saveButton = document.getElementById('save-button');
        const editListEl = document.getElementById('edit-list');
        const editFilterMenu = document.getElementById('edit-filter-menu');

        // Global Elements
        const navBadge = document.getElementById('nav-badge');
        const quickOrderNavBtn = document.getElementById('quick-order-nav-btn');
        const homeNavBtn = document.getElementById('home-nav-btn');
        const bottomNav = document.getElementById('bottom-nav');
        const orderBar = document.getElementById('order-bar');
        const logoHome = document.getElementById('logo-home');
        const logoQuickOrder = document.getElementById('logo-quick-order');

        // --- NEW: ONBOARDING ELEMENTS ---
        const onboardingOverlay = document.getElementById('onboarding-overlay');
        const onboardingBottomSheet = document.getElementById('onboarding-bottom-sheet');
        const onboardingCloseBtnTop = document.getElementById('onboarding-close-btn-top');
        const onboardingWatchVideoBtn = document.getElementById('onboarding-watch-video-btn');
        const onboardingStartTourBtn = document.getElementById('onboarding-start-tour-btn');
        
        const videoGuideModal = document.getElementById('video-guide-modal');
        const videoModalCloseBtn = document.getElementById('video-modal-close-btn');

        const coachMarkContainer = document.getElementById('coach-mark-container');
        const coachMark1 = document.getElementById('coach-mark-1');
        const coachMark2 = document.getElementById('coach-mark-2');
        const coachMark3 = document.getElementById('coach-mark-3');
        const coachMarkNext1 = document.getElementById('coach-mark-next-1');
        const coachMarkNext2 = document.getElementById('coach-mark-next-2');
        const coachMarkDone = document.getElementById('coach-mark-done');
        // --- END NEW ELEMENTS ---


        // --- UTILS ---
        function getAllProducts() {
            return Object.values(appState.products).flat();
        }

        // --- VIEW MANAGEMENT ---
        function showHomeView() {
            appState.currentView = 'home';
            homeView.classList.remove('hidden');
            quickOrderView.classList.add('hidden');
            editView.classList.add('hidden');

            orderBar.classList.add('hidden');
            bottomNav.classList.remove('hidden');

            homeNavBtn.classList.add('text-green-500');
            homeNavBtn.querySelector('span').classList.add('font-bold');
            quickOrderNavBtn.classList.remove('text-green-500');
            quickOrderNavBtn.querySelector('span').classList.remove('font-bold');

            updateLikedCountBadge(); // í™ˆ ë·°ì—ì„œëŠ” ì°œ ê°œìˆ˜ í‘œì‹œ
            renderHomeView();
        }

        function showQuickOrderView() {
            // --- NEW: ONBOARDING TRIGGER ---
            // 'ë¹ ë¥¸ì£¼ë¬¸' ë·°ë¡œ ì „í™˜ë  ë•Œ, ê·¸ë¦¬ê³  ì˜¨ë³´ë”©ì„ ì•„ì§ ì™„ë£Œí•˜ì§€ ì•Šì•˜ì„ ë•Œ ì‹¤í–‰
            // const onboardingComplete = localStorage.getItem('quickOrderOnboardingComplete') === 'true'; // í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ì£¼ì„ ì²˜ë¦¬
            
            // í˜„ì¬ ë·°ê°€ 'quick-order'ê°€ ì•„ë‹ ë•Œë§Œ (ì¦‰, íƒ­ì„ 'í´ë¦­í•´ì„œ' ì „í™˜í•  ë•Œë§Œ) ì˜¨ë³´ë”©ì„ ì²´í¬
            if (appState.currentView !== 'quick-order' /* && !onboardingComplete */) { // í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ !onboardingComplete ì¡°ê±´ ì œê±°
                // ë·°ê°€ ì™„ì „íˆ í‘œì‹œëœ í›„ ì˜¨ë³´ë”©ì„ ì‹œì‘í•˜ê¸° ìœ„í•´ setTimeout ì‚¬ìš© (100ms)
                setTimeout(startQuickOrderOnboarding, 100); 
            }
            // --- END NEW TRIGGER ---

            appState.currentView = 'quick-order';
            homeView.classList.add('hidden');
            quickOrderView.classList.remove('hidden');
            editView.classList.add('hidden');

            orderBar.classList.remove('hidden');
            bottomNav.classList.remove('hidden');

            homeNavBtn.classList.remove('text-green-500');
            homeNavBtn.querySelector('span').classList.remove('font-bold');
            quickOrderNavBtn.classList.add('text-green-500');
            quickOrderNavBtn.querySelector('span').classList.add('font-bold');

            resetQuickOrderView();
            updateOrderButton(); // ë¹ ë¥¸ ì£¼ë¬¸ ë·°ì—ì„œëŠ” ì¥ë°”êµ¬ë‹ˆ ê°œìˆ˜ í‘œì‹œ
        }

        function showEditView() {
            appState.currentView = 'edit';
            homeView.classList.add('hidden');
            quickOrderView.classList.add('hidden');
            editView.classList.remove('hidden');

            orderBar.classList.add('hidden');
            bottomNav.classList.add('hidden');

            appState.editListFilter = null;
            renderEditView();
        }

        // --- NEW: ONBOARDING LOGIC (ìƒˆë¡œìš´ ê¸°ëŠ¥ ì˜¨ë³´ë”© ë¡œì§) ---
        function startQuickOrderOnboarding() {
            // í…ŒìŠ¤íŠ¸ìš©: ì˜¨ë³´ë”©ì„ ë‹¤ì‹œ ë³´ë ¤ë©´ ì£¼ì„ í•´ì œ
            // localStorage.removeItem('quickOrderOnboardingComplete');
            
            // ì´ë¯¸ ì™„ë£Œí–ˆë‹¤ë©´ ì‹¤í–‰í•˜ì§€ ì•ŠìŒ
            // if (localStorage.getItem('quickOrderOnboardingComplete') === 'true') return; // í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ì£¼ì„ ì²˜ë¦¬
            
            onboardingOverlay.classList.add('active');
            onboardingBottomSheet.classList.add('active');
        }

        function showCoachMarks() {
            onboardingBottomSheet.classList.remove('active'); // í•˜ë‹¨ ì‹œíŠ¸ ë‹«ê¸°

            // 1. ì½”ì¹˜ ë§ˆí¬ê°€ ê°€ë¦¬í‚¬ ëŒ€ìƒ ìš”ì†Œë“¤
            const dangolTab = document.querySelector('.my-list-tab[data-list="0"]');
            const listTabsContainer = document.getElementById('my-list-tabs');
            const editBtn = document.getElementById('edit-button');

            // ìš”ì†Œê°€ ì—†ìœ¼ë©´ ì¤‘ë‹¨
            if (!dangolTab || !listTabsContainer || !editBtn) {
                endOnboarding(); // ê·¸ëƒ¥ ì¢…ë£Œ
                return;
            }

            // 2. ëŒ€ìƒ ìš”ì†Œë“¤ì˜ í™”ë©´ìƒ ìœ„ì¹˜ ê³„ì‚°
            const dangolRect = dangolTab.getBoundingClientRect();
            const tabsRect = listTabsContainer.getBoundingClientRect();
            const editRect = editBtn.getBoundingClientRect();
            
            // 3. ì½”ì¹˜ ë§ˆí¬ ìœ„ì¹˜ ë™ì  ì„¤ì • (ìš”ì†Œ ë°”ë¡œ ì•„ë˜ + ê¼¬ë¦¬(10px) + ì—¬ë°±(5px))
            const offset = 15; // ë§í’ì„  ê¼¬ë¦¬ + ì—¬ë°±

            // ì½”ì¹˜ ë§ˆí¬ 1 (ë‹¨ê³¨íŠ¹ê°€) ìœ„ì¹˜ ì„¤ì •
            coachMark1.style.top = (dangolRect.bottom + offset) + 'px';
            coachMark1.style.left = (dangolRect.left - 10) + 'px'; // íƒ­ë³´ë‹¤ ì‚´ì§ ì™¼ìª½ì—ì„œ ì‹œì‘

            // ì½”ì¹˜ ë§ˆí¬ 2 (ìŠ¤ì™€ì´í”„) ìœ„ì¹˜ ì„¤ì •
            coachMark2.style.top = (tabsRect.bottom + offset) + 'px';
            // í™”ë©´ ì¤‘ì•™ ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°
            const appCenter = appContainer.getBoundingClientRect().left + (appContainer.getBoundingClientRect().width / 2);
            coachMark2.style.left = (appCenter - (coachMark2.getBoundingClientRect().width / 2)) + 'px';

            // ì½”ì¹˜ ë§ˆí¬ 3 (í¸ì§‘) ìœ„ì¹˜ ì„¤ì •
            coachMark3.style.top = (editRect.bottom + offset) + 'px';
            coachMark3.style.left = (editRect.right - 260 + 10) + 'px'; // 260pxëŠ” ì½”ì¹˜ë§ˆí¬ ë„ˆë¹„
            
            // ì²« ë²ˆì§¸ ì½”ì¹˜ ë§ˆí¬ í™œì„±í™”
            coachMark1.classList.add('active');
        }

        // (NEW) ë™ì˜ìƒ ëª¨ë‹¬ ì—´ê¸°
        function showVideoGuide() {
            onboardingBottomSheet.classList.remove('active'); // í•˜ë‹¨ ì‹œíŠ¸ ë‹«ê¸°
            videoGuideModal.classList.add('active');
        }

        function endOnboarding() {
            // ëª¨ë“  ì˜¨ë³´ë”© UI ìˆ¨ê¸°ê¸°
            onboardingOverlay.classList.remove('active');
            onboardingBottomSheet.classList.remove('active');
            videoGuideModal.classList.remove('active'); // ë¹„ë””ì˜¤ ëª¨ë‹¬ë„ ë‹«ê¸°
            coachMark1.classList.remove('active');
            coachMark2.classList.remove('active');
            coachMark3.classList.remove('active');
            
            // ì™„ë£Œ ìƒíƒœ ì €ì¥ (ë‹¤ì‹œ ë³´ì§€ ì•Šë„ë¡)
            // localStorage.setItem('quickOrderOnboardingComplete', 'true'); // í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ì£¼ì„ ì²˜ë¦¬
        }
        // --- END NEW ONBOARDING LOGIC ---


        // --- HOME VIEW LOGIC ---
        // (ê¸°ì¡´ í•¨ìˆ˜... ìƒëµ)
        function renderHomeView() {
            if (!homeProductListEl) return;
            const homeProducts = getAllProducts().filter(p => p.id >= 100); // ë°ëª¨ìš© ìƒí’ˆ
            homeProductListEl.innerHTML = homeProducts.map(p => {
                const allowLike = p.allowLike !== false; // ê¸°ë³¸ê°’ true
                const checkboxHtml = allowLike
                    ? `<input type="checkbox" class="home-product-checkbox h-6 w-6 rounded border-gray-300 text-green-600 focus:ring-green-500" data-id="${p.id}" ${p.liked ? 'checked' : ''}>`
                    : `<span class="h-6 w-6 flex items-center justify-center text-gray-300 border border-gray-300 rounded" title="ì°œ ë¶ˆê°€"><i class="fas fa-times"></i></span>`; // ë¹„í™œì„± í‘œì‹œ

                return `
                <div class="flex items-center p-4" data-id="${p.id}">
                    <img src="${p.img || `https://placehold.co/80x80/eeeeee/333333?text=${p.name.substring(0, 3)}`}" alt="${p.name}" class="w-16 h-16 object-cover rounded-md flex-shrink-0 mr-4" onerror="this.src='https://placehold.co/80x80/eeeeee/cccccc?text=No+Image'">
                    <div class="flex-grow">
                        <p class="text-xs text-gray-500">${p.isEvent ? 'í•œì •íŒë§¤' : 'ì¼ë°˜'}</p>
                        <p class="font-semibold">${p.name}</p>
                        <p class="font-bold text-green-600 text-lg">${p.price > 0 ? p.price.toLocaleString()+'ì›' : 'ì‹¯ê°€'}</p>
                    </div>
                    ${checkboxHtml}
                </div>
                `;
            }).join('');
        }

        function updateLikedCountBadge() {
            const likedCount = getAllProducts().filter(p => p.liked).length;
            // í™ˆ ë·°ì¼ ë•Œë§Œ ì°œ ê°œìˆ˜ ë±ƒì§€ ì—…ë°ì´íŠ¸
            if (appState.currentView === 'home') {
                navBadge.textContent = likedCount;
            }
        }

        if (homeProductListEl) {
            homeProductListEl.addEventListener('change', e => {
                if (e.target.matches('.home-product-checkbox:not(:disabled)')) {
                    const productId = parseInt(e.target.dataset.id, 10);
                    const isChecked = e.target.checked;
                    const product = getAllProducts().find(p => p.id === productId);
                    if (product) {
                        product.liked = isChecked;
                        product.likedTimestamp = isChecked ? Date.now() : null;
                        if (!isChecked) {
                            product.myList = [];
                        }
                    }
                    updateLikedCountBadge();
                }
            });
        }


        // --- QUICK ORDER LOGIC ---
        // (ê¸°ì¡´ í•¨ìˆ˜... ìƒëµ)
        function toggleSearchMode(show) {
            appState.isSearching = show;
            searchContainer.classList.toggle('search-hidden', !show);
            appContainer.classList.toggle('search-mode-active', show);

            if (show) {
                productSearchInput.focus();
            } else {
                if (appState.searchTerm) {
                    productSearchInput.value = '';
                    appState.searchTerm = '';
                    renderProducts();
                }
            }
        }

        myListTabsContainer.addEventListener('click', (e) => {
            if (e.target.matches('.my-list-tab')) {
                productSearchInput.value = '';
                appState.searchTerm = '';
                toggleSearchMode(false);

                orderConfirmationContainer.classList.add('hidden');
                productListContainer.classList.remove('hidden');
                updateOrderButton();

                const listNumber = parseInt(e.target.dataset.list, 10);
                appState.currentMyList = listNumber;

                myListTabsContainer.querySelectorAll('.my-list-tab').forEach(tab => {
                    tab.classList.remove('tab-active');
                    tab.classList.add('tab-inactive');
                });
                e.target.classList.add('tab-active');
                e.target.classList.remove('tab-inactive');
                renderProducts();
            }
        });

        function getProductItemHtml(p, isDangolTab = false) {
            const isSelected = appState.cart[p.id] > 0;
            const priceText = p.price > 0 ? `${p.price.toLocaleString()}ì›` : 'ì‹¯ê°€';
            const allowLike = p.allowLike !== false;

            // --- ì°œ ì²´í¬ë°•ìŠ¤ ë˜ëŠ” ì•„ì´ì½˜ ---
            let likeCheckboxHtml = '';
            if (isDangolTab) {
                if (allowLike) {
                    likeCheckboxHtml = `<input type="checkbox" class="dangol-like-checkbox h-5 w-5 rounded border-gray-300 text-green-600 focus:ring-green-500 mr-1 flex-shrink-0" data-id="${p.id}" ${p.liked ? 'checked' : ''}>`;
                } else {
                    likeCheckboxHtml = `<span class="h-5 w-5 flex items-center justify-center text-gray-300 border border-gray-300 rounded mr-1 flex-shrink-0 like-disabled-icon" title="ì°œ ë¶ˆê°€"></span>`;
                }
            }

            // --- íŠ¹ê°€ ë°°ì§€ ---
            const eventBadgeHtml = p.isEvent
                ? `<span class="text-xs font-bold text-red-500 bg-red-100 px-1.5 py-0.5 rounded-full">íŠ¹ê°€</span>`
                : '';
            const eventBadgeLocationClass = isDangolTab ? 'mt-1' : 'ml-1';

            // --- Brand & Date Logic ---
            const deliveryDateStr = p.deliveryDate;
            let deliveryHtml = '';
            let brandHtml = '';

            if (p.spec && p.spec.startsWith('íŒë§¤ì²˜: ')) {
                const brandName = p.spec.replace('íŒë§¤ì²˜: ', '');
                brandHtml = `<span class="font-bold text-gray-700 mr-2">${brandName}</span>`;
            }

            if (deliveryDateStr) {
                const today = new Date('2025-10-20T00:00:00');
                today.setHours(0, 0, 0, 0);
                const msPerDay = 1000 * 60 * 60 * 24;

                const deliveryDate = new Date(deliveryDateStr + 'T00:00:00');
                deliveryDate.setHours(0, 0, 0, 0);
                const dayDiff = (deliveryDate.getTime() - today.getTime()) / msPerDay;

                let deliveryText = '';
                let dateColorClass = '';

                if (dayDiff === 1) {
                    deliveryText = 'ë‚´ì¼ë°°ì†¡ (20ì‹œ ë§ˆê°)';
                    dateColorClass = 'text-blue-600 font-semibold';
                } else if (dayDiff > 1) {
                    const dateParts = deliveryDateStr.split('-');
                    const monthDay = `${dateParts[1]}-${dateParts[2]}`;
                    deliveryText = `${monthDay} ë°°ì†¡ (20ì‹œ ë§ˆê°)`;
                    dateColorClass = 'text-red-600 font-semibold';
                } else {
                    const dateParts = deliveryDateStr.split('-');
                    const monthDay = `${dateParts[1]}-${dateParts[2]}`;
                    deliveryText = `${monthDay} ë°°ì†¡`;
                }
                deliveryHtml = `<span class="${dateColorClass}">${deliveryText}</span>`;
            }
            // --- End Brand & Date Logic ---

            let displaySpec = '';
            if (p.spec && !p.spec.startsWith('íŒë§¤ì²˜: ')) {
                displaySpec = p.spec;
            }

            const line1Text = `${brandHtml}${deliveryHtml}`;
            const line2Text = displaySpec ? `${p.name} (${displaySpec})` : p.name;

            return `
            <div class="product-item flex items-start space-x-2 p-2 rounded-lg ${isSelected ? 'product-item-selected' : 'bg-white'}" data-id="${p.id}">
                ${isDangolTab ? 
                    `<div class="flex flex-col items-center flex-shrink-0 pt-0.5">${likeCheckboxHtml}</div>` : ''
                }
                
                <div class="flex flex-col items-center flex-shrink-0">
                    <img src="${p.img || `https://placehold.co/80x80/eeeeee/333333?text=${p.name.substring(0, 3)}`}" alt="${p.name}" class="w-14 h-14 object-cover rounded-md" onerror="this.src='https://placehold.co/80x80/eeeeee/cccccc?text=No+Image'">
                    ${isDangolTab ? `<div class="${eventBadgeLocationClass}">${eventBadgeHtml}</div>` : ''}
                </div>
                
                <div class="flex-grow">
                    <p class="font-bold text-sm">${line2Text}</p>
                    <p class="text-xs text-gray-500 mt-0.5">${line1Text}</p>
                </div>
                
                <div class="flex flex-col items-end flex-shrink-0">
                    <p class="font-bold whitespace-nowrap">${priceText} ${!isDangolTab ? eventBadgeHtml : ''}</p>
                    <div class="flex items-center mt-1 border rounded-md">
                        <button class="quantity-btn quantity-decrease bg-gray-100 rounded-l-md">-</button>
                        <input type="number" class="quantity-input w-10 text-center border-l border-r text-sm" value="${appState.cart[p.id] || 0}" min="0">
                        <button class="quantity-btn quantity-increase bg-gray-100 rounded-r-md">+</button>
                    </div>
                </div>
            </div>
            `;
        }

        function renderProducts() {
            let productsToRenderHtml = '';
            const allProducts = getAllProducts();
            const likedProducts = allProducts.filter(p => p.liked);

            let baseList = [];

            // íƒ­ë³„ ê¸°ë³¸ ëª©ë¡ ì •ì˜
            if (appState.currentMyList === 0) { // ë‹¨ê³¨íŠ¹ê°€
                const likedThirdCategories = new Set(likedProducts.map(p => p.thirdCategory).filter(Boolean));
                if (likedThirdCategories.size > 0) {
                    baseList = allProducts.filter(p => p.isEvent && likedThirdCategories.has(p.thirdCategory));
                } else {
                    // ì°œí•œ ìƒí’ˆì´ 0ê°œì¼ ë•Œ (ì‹ ê·œ ìœ ì €) -> ëª¨ë“  í–‰ì‚¬ ìƒí’ˆ ë…¸ì¶œ
                    baseList = allProducts.filter(p => p.isEvent);
                }
            } else if (appState.currentMyList === 1) { // LIST 1
                baseList = likedProducts; // ì°œí•œ ìƒí’ˆ ì „ì²´ (ë¯¸ì§€ì • + LIST 1 ì§€ì •)
            } else { // LIST 2, 3
                baseList = likedProducts.filter(p => p.myList && p.myList.includes(appState.currentMyList));
            }

            // ê²€ìƒ‰ì–´ ì ìš©
            let filteredList = baseList;
            if (appState.searchTerm) {
                const searchTermLower = appState.searchTerm.toLowerCase();
                filteredList = baseList.filter(p => p.name.toLowerCase().includes(searchTermLower));
            }

            // í™”ë©´ ì¶œë ¥ ë¡œì§
            if (filteredList.length === 0) {
                let message = "í‘œì‹œí•  ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.";
                if (appState.currentMyList === 0 && likedProducts.length === 0) {
                    message = "ì „ì²´ íŠ¹ê°€ ìƒí’ˆì…ë‹ˆë‹¤. 'í™ˆ'ì—ì„œ ì°œí•˜ë©´ ë§ì¶¤ íŠ¹ê°€ë¡œ ë³€ê²½ë©ë‹ˆë‹¤.";
                } else if (appState.searchTerm) {
                    message = `'${appState.searchTerm}'ì— ëŒ€í•œ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.`;
                } else if (appState.currentMyList === 1 && likedProducts.length === 0) {
                    message = "'í™ˆ'ì—ì„œ ìƒí’ˆì„ ì°œí•˜ë©´, ê´€ë¦¬í•  ìƒí’ˆì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.";
                } else if (appState.currentMyList > 1 && likedProducts.length === 0) {
                    message = `LIST ${appState.currentMyList}ì— ì§€ì •ëœ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.`;
                }
                productsToRenderHtml = `<div class="text-center py-10 text-gray-500">${message}</div>`;
            } else {
                if (appState.currentMyList === 0) { // ë‹¨ê³¨íŠ¹ê°€
                    filteredList.sort((a, b) => a.id - b.id);
                    productsToRenderHtml = filteredList.map(p => getProductItemHtml(p, true)).join('');
                } else if (appState.currentMyList === 1) { // LIST 1 (ë¯¸ì§€ì • + ì§€ì • ë¶„ë¦¬)
                    const unassigned = filteredList
                        .filter(p => !p.myList || p.myList.length === 0)
                        .sort((a, b) => (b.likedTimestamp || 0) - (a.likedTimestamp || 0)); // ìµœê·¼ìˆœ

                    const assigned = filteredList
                        .filter(p => p.myList && p.myList.includes(1))
                        .sort((a, b) => a.id - b.id); // ID ìˆœ

                    let unassignedHtml = '';
                    if (unassigned.length > 0) {
                        unassignedHtml = `
                            <h4 class="list1-section-header-sticky text-sm font-semibold text-blue-600">ë¦¬ìŠ¤íŠ¸ ë¯¸ì§€ì • ìƒí’ˆ (${unassigned.length})</h4>
                            <div class="space-y-2 mt-1">
                                ${unassigned.map(p => getProductItemHtml(p)).join('')}
                            </div>
                        `;
                    }
                    let assignedHtml = '';
                    if (assigned.length > 0) {
                        const separator = unassigned.length > 0 ? '<div class="pt-2"></div>' : '';
                        assignedHtml = `
                            ${separator}
                            <h4 class="list1-section-header-sticky text-sm font-semibold text-gray-700">LIST 1 ì§€ì • ìƒí’ˆ (${assigned.length})</h4>
                                <div class="space-y-2 mt-1">
                                ${assigned.map(p => getProductItemHtml(p)).join('')}
                            </div>
                        `;
                    }
                    productsToRenderHtml = unassignedHtml + assignedHtml;

                    if (!productsToRenderHtml && !appState.searchTerm) {
                        productsToRenderHtml = `<div class="text-center py-10 text-gray-500">ì°œí•œ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
                    }

                } else { // LIST 2, 3
                    filteredList.sort((a, b) => a.id - b.id);
                    productsToRenderHtml = filteredList.map(p => getProductItemHtml(p)).join('');
                }
            }

            productListEl.innerHTML = productsToRenderHtml;
        }


        // --- CART LOGIC ---
        // (ê¸°ì¡´ í•¨ìˆ˜... ìƒëµ)
        function updateCart(productId, quantity) {
            quantity = Math.max(0, quantity);
            if (quantity > 0) {
                appState.cart[productId] = quantity;
            } else {
                delete appState.cart[productId];
            }
            updateOrderButton();
        }

        function updateOrderButton() {
            const totalProducts = Object.keys(appState.cart).length;
            let totalPrice = 0;
            const allProducts = getAllProducts();

            for (const id in appState.cart) {
                const product = allProducts.find(p => p.id == id);
                if (product) {
                    totalPrice += (product.price || 0) * appState.cart[id];
                }
            }

            if (appState.currentView === 'quick-order') {
                navBadge.textContent = totalProducts;
            }

            if (totalProducts > 0) {
                orderButton.classList.remove('order-btn-disabled', 'bg-gray-400');
                orderButton.classList.add('bg-green-500', 'hover:bg-green-600');
                orderBubble.textContent = totalProducts;
                orderBubble.classList.remove('hidden');

                if (appState.currentView === 'quick-order' && orderConfirmationContainer.classList.contains('hidden')) {
                    orderButtonText.textContent = 'ë‹´ì€ ìƒí’ˆ í™•ì¸í•˜ê¸°';
                } else {
                    orderButtonText.textContent = `ì´ ${totalPrice.toLocaleString()}ì› ì£¼ë¬¸í•˜ê¸°`;
                }
            } else {
                orderButton.classList.add('order-btn-disabled', 'bg-gray-400');
                orderButton.classList.remove('bg-green-500', 'hover:bg-green-600');
                orderButtonText.textContent = 'ì£¼ë¬¸í•  ìƒí’ˆì„ ë‹´ì•„ì£¼ì„¸ìš”';
                orderBubble.classList.add('hidden');
                if(!orderConfirmationContainer.classList.contains('hidden')) {
                    resetQuickOrderView();
                }
            }
        }

        // --- CONFIRMATION VIEW LOGIC (With Toggle) ---
        // (ê¸°ì¡´ í•¨ìˆ˜... ìƒëµ)
        function showConfirmationView() {
            orderConfirmationContainer.classList.remove('hidden');
            productListContainer.classList.add('hidden');
            toggleSearchMode(false); // ê²€ìƒ‰ì°½ ë‹«ê¸°

            // í† ê¸€ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            orderViewToggle.querySelectorAll('.order-view-toggle-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.mode === appState.orderViewMode);
                btn.classList.toggle('inactive', btn.dataset.mode !== appState.orderViewMode);
            });

            const cartItems = Object.keys(appState.cart);
            const allProducts = getAllProducts();
            const itemsToConfirm = allProducts.filter(p => cartItems.includes(p.id.toString()));

            const totalQuantity = Object.values(appState.cart).reduce((total, quantity) => total + quantity, 0);
            document.getElementById('confirmation-total-count').textContent = `ì´ ${totalQuantity}ê°œ`;
            
            let groupedHtml = '';

            // --- 'ì¹´í…Œê³ ë¦¬ë³„' ë³´ê¸° ë¡œì§ ---
            if (appState.orderViewMode === 'category') {
                const categoryNames = {
                    'vegetable': 'ì±„ì†Œ/ê³¼ì¼', 'seafood': 'ìˆ˜ì‚°/ì¶•ì‚°', 'processed': 'ì‹í’ˆ/ê°€ê³µ', 'sauce': 'ì–‘ë…/ì†ŒìŠ¤', 'kitchen': 'ì£¼ë°©/ì¡í™”'
                };
                const groupedItems = itemsToConfirm.reduce((acc, item) => {
                    const category = categoryNames[item.category] || 'ê¸°íƒ€';
                    if (!acc[category]) acc[category] = [];
                    acc[category].push(item);
                    return acc;
                }, {});

                groupedHtml = Object.entries(groupedItems).map(([category, items]) => 
                    renderConfirmationGroup(category, items)
                ).join('');
            } 
            // --- 'ë¦¬ìŠ¤íŠ¸ë³„' ë³´ê¸° ë¡œì§ (ìƒˆë¡œìš´ ìš°ì„ ìˆœìœ„) ---
            else {
                const groups = {
                    event: { title: 'í–‰ì‚¬ ìƒí’ˆ', items: [] },
                    unassigned: { title: 'ë¦¬ìŠ¤íŠ¸ ë¯¸ì§€ì • ìƒí’ˆ', items: [] },
                    list1: { title: 'LIST 1 ì§€ì • ìƒí’ˆ', items: [] },
                    listOther: { title: 'LIST 2 & 3 ì§€ì • ìƒí’ˆ', items: [] }
                };
                
                // 1. ìš°ì„ ìˆœìœ„ì— ë”°ë¼ ê·¸ë£¹í™” (ì¤‘ë³µ ì œê±°)
                itemsToConfirm.forEach(item => {
                    if (item.isEvent) {
                        groups.event.items.push(item);
                    } else if (!item.myList || item.myList.length === 0) {
                        groups.unassigned.items.push(item);
                    } else if (item.myList.includes(1)) {
                        groups.list1.items.push(item);
                    } else if (item.myList.includes(2) || item.myList.includes(3)) {
                        groups.listOther.items.push(item);
                    }
                });

                // 2. ì •ë ¬ ë° HTML ìƒì„±
                // í–‰ì‚¬, List 1, List OtherëŠ” IDìˆœ (ê³ ì •ì„±)
                groups.event.items.sort((a,b) => a.id - b.id);
                groups.list1.items.sort((a,b) => a.id - b.id);
                groups.listOther.items.sort((a,b) => a.id - b.id);
                // ë¯¸ì§€ì • ìƒí’ˆì€ ìµœê·¼ ì°œí•œ ìˆœ (í™•ì¸ ë‹ˆì¦ˆ)
                groups.unassigned.items.sort((a, b) => (b.likedTimestamp || 0) - (a.likedTimestamp || 0));

                // 3. HTML ë Œë”ë§
                groupedHtml = [
                    groups.event, groups.unassigned, groups.list1, groups.listOther
                ].filter(group => group.items.length > 0)
                .map(group => renderConfirmationGroup(group.title, group.items))
                .join('');
            }
            
            confirmationListEl.innerHTML = groupedHtml || `<div class="text-center py-5 text-gray-500">ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
            updateOrderButton();
        }
        
        // 'ì£¼ë¬¸ í™•ì¸' í™”ë©´ì˜ ê·¸ë£¹ ë Œë”ë§ í—¬í¼ í•¨ìˆ˜
        function renderConfirmationGroup(title, items) {
             return `
                <div class="mb-4">
                    <h3 class="font-bold text-md mb-2 pb-2 border-b">${title} (${items.length})</h3>
                    <div class="space-y-3 mt-3">
                        ${items.map(p => {
                            const itemTotalPrice = (p.price || 0) * appState.cart[p.id];
                            return `
                            <div class="product-item flex items-center space-x-3 p-2 rounded-lg product-item-selected" data-id="${p.id}">
                                <img src="${p.img || `https://placehold.co/80x80/eeeeee/333333?text=${p.name.substring(0, 3)}`}" alt="${p.name}" class="w-16 h-16 object-cover rounded-md flex-shrink-0" onerror="this.src='https://placehold.co/80x80/eeeeee/cccccc?text=No+Image'">
                                <div class="flex-grow">
                                    <p class="font-bold text-sm">${p.name}</p>
                                    <p class="text-xs text-gray-500">${p.spec}</p>
                                </div>
                                <div class="flex flex-col items-end flex-shrink-0">
                                    <p class="font-bold whitespace-nowrap">${itemTotalPrice > 0 ? itemTotalPrice.toLocaleString()+'ì›' : 'ì‹¯ê°€'}</p>
                                    <div class="flex items-center mt-1 border rounded-md">
                                        <button class="quantity-btn quantity-decrease bg-gray-100 rounded-l-md">-</button>
                                        <input type="number" class="quantity-input w-10 text-center border-l border-r text-sm" value="${appState.cart[p.id]}" min="0">
                                        <button class="quantity-btn quantity-increase bg-gray-100 rounded-r-md">+</button>
                                    </div>
                                </div>
                            </div>
                        `}).join('')}
                    </div>
                </div>
            `;
        }

        function resetQuickOrderView() {
            productSearchInput.value = '';
            appState.searchTerm = '';
            toggleSearchMode(false);

            appState.currentMyList = 0; // ê¸°ë³¸ íƒ­ì€ ë‹¨ê³¨íŠ¹ê°€

            myListTabsContainer.querySelectorAll('.my-list-tab').forEach(tab => {
                const isDanGol = parseInt(tab.dataset.list, 10) === 0;
                tab.classList.toggle('tab-active', isDanGol);
                tab.classList.toggle('tab-inactive', !isDanGol);
            });

            orderConfirmationContainer.classList.add('hidden');
            productListContainer.classList.remove('hidden');

            renderProducts(); // ê¸°ë³¸ íƒ­(ë‹¨ê³¨íŠ¹ê°€) ìƒí’ˆ ë Œë”ë§
        }

        // --- EVENT LISTENERS ---
        // (ê¸°ì¡´ ë¦¬ìŠ¤ë„ˆ... ìƒëµ)
        quickOrderView.addEventListener('click', function(e) {
            // ìˆ˜ëŸ‰ ì¡°ì ˆ ë²„íŠ¼
            const productItem = e.target.closest('.product-item');
            if (!productItem) return;

            const productId = productItem.dataset.id;
            let quantityInput = productItem.querySelector('.quantity-input');
            if (!quantityInput) return; // ìˆ˜ëŸ‰ ì…ë ¥ì¹¸ì´ ì—†ëŠ” ìš”ì†Œë¥¼ í´ë¦­í–ˆì„ ê²½ìš° ë°©ì§€
            
            let currentQuantity = parseInt(quantityInput.value);
            let quantityChanged = false;

            if (e.target.closest('.quantity-increase')) {
                currentQuantity++;
                quantityInput.value = currentQuantity;
                updateCart(productId, currentQuantity);
                quantityChanged = true;
            } else if (e.target.closest('.quantity-decrease')) {
                currentQuantity = Math.max(0, currentQuantity - 1);
                quantityInput.value = currentQuantity;
                updateCart(productId, currentQuantity);
                quantityChanged = true;
                if (!orderConfirmationContainer.classList.contains('hidden') && currentQuantity === 0) {
                    showConfirmationView(); // ì£¼ë¬¸í™•ì¸ í™”ë©´ì—ì„œ 0 ë˜ë©´ ë‹¤ì‹œ ê·¸ë¦¼
                    return;
                }
            }

            if (quantityChanged) {
                const isSelected = currentQuantity > 0;
                productItem.classList.toggle('product-item-selected', isSelected);
                productItem.classList.toggle('bg-white', !isSelected);
            }
        });

        quickOrderView.addEventListener('change', function(e) {
            // ìˆ˜ëŸ‰ ì§ì ‘ ì…ë ¥
            if (e.target.classList.contains('quantity-input')) {
                const productItem = e.target.closest('.product-item');
                const productId = productItem.dataset.id;
                let newQuantity = parseInt(e.target.value);
                if (isNaN(newQuantity) || newQuantity < 0) {
                    newQuantity = 0;
                    e.target.value = 0;
                }
                updateCart(productId, newQuantity);

                const isSelected = newQuantity > 0;
                productItem.classList.toggle('product-item-selected', isSelected);
                productItem.classList.toggle('bg-white', !isSelected);

                if (!orderConfirmationContainer.classList.contains('hidden') && newQuantity === 0) {
                    showConfirmationView();
                }
            }

            // ë‹¨ê³¨íŠ¹ê°€ íƒ­ ì°œí•˜ê¸°
            if (e.target.matches('.dangol-like-checkbox:not(:disabled)')) {
                const productId = parseInt(e.target.dataset.id, 10);
                const isChecked = e.target.checked;
                const product = getAllProducts().find(p => p.id === productId);
                if (product) {
                    product.liked = isChecked;
                    product.likedTimestamp = isChecked ? Date.now() : null;
                    if (!isChecked) {
                        product.myList = [];
                    }
                }
                updateLikedCountBadge();
            }
        });
        
        // ì£¼ë¬¸ í™•ì¸ í™”ë©´ í† ê¸€ ë²„íŠ¼ ë¦¬ìŠ¤ë„ˆ
        if(orderViewToggle) {
            orderViewToggle.addEventListener('click', (e) => {
                const btn = e.target.closest('.order-view-toggle-btn');
                if (btn && !btn.classList.contains('active')) {
                    appState.orderViewMode = btn.dataset.mode;
                    showConfirmationView(); // ë·° ëª¨ë“œ ë³€ê²½ í›„ ë‹¤ì‹œ ë Œë”ë§
                }
            });
        }


        // --- EDIT VIEW LOGIC ---
        // (ê¸°ì¡´ í•¨ìˆ˜... ìƒëµ)
        function renderEditView() {
            editFilterMenu.querySelectorAll('.edit-filter-btn').forEach(btn => {
                const filterValue = btn.dataset.filter === 'null' ? null : parseInt(btn.dataset.filter, 10);
                btn.classList.toggle('active', appState.editListFilter === filterValue);
            });

            let likedProducts = getAllProducts().filter(p => p.liked);

            likedProducts.sort((a, b) => { // ë¯¸ì§€ì • ìƒí’ˆ ìƒë‹¨ ì •ë ¬
                const aHasList = a.myList && a.myList.length > 0;
                const bHasList = b.myList && b.myList.length > 0;
                if (aHasList === bHasList) { return a.id - b.id; }
                return aHasList ? 1 : -1;
            });

            let productsToRender = likedProducts;
            if (appState.editListFilter !== null) {
                productsToRender = likedProducts.filter(p => p.myList && p.myList.includes(appState.editListFilter));
            }

            editListEl.innerHTML = productsToRender.map(p => `
                <div class="edit-item flex items-center p-3" data-id="${p.id}">
                    <button class="delete-item-btn mr-4 text-gray-400 hover:text-red-500 w-8 h-8 flex items-center justify-center">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                    <div class="flex-grow pr-4">
                        <p class="font-semibold text-sm">${p.name}</p>
                        <p class="text-xs text-gray-500">${p.price > 0 ? p.price.toLocaleString()+'ì›' : 'ì‹¯ê°€'}</p>
                    </div>
                    <div class="flex items-center space-x-1">
                        <button class="list-assign-btn border w-8 h-8 rounded text-sm ${p.myList && p.myList.includes(1) ? 'bg-green-500 text-white' : ''}" data-list="1">1</button>
                        <button class="list-assign-btn border w-8 h-8 rounded text-sm ${p.myList && p.myList.includes(2) ? 'bg-green-500 text-white' : ''}" data-list="2">2</button>
                        <button class="list-assign-btn border w-8 h-8 rounded text-sm ${p.myList && p.myList.includes(3) ? 'bg-green-500 text-white' : ''}" data-list="3">3</button>
                    </div>
                    <div class="ml-2 text-gray-400 cursor-grab">
                        <i class="fas fa-grip-vertical"></i>
                    </div>
                </div>
            `).join('');
        }

        editFilterMenu.addEventListener('click', (e) => {
            if(e.target.matches('.edit-filter-btn')) {
                const filter = e.target.dataset.filter;
                appState.editListFilter = filter === 'null' ? null : parseInt(filter, 10);
                renderEditView();
            }
        });

        editListEl.addEventListener('click', (e) => {
            const assignBtn = e.target.closest('.list-assign-btn');
            const deleteBtn = e.target.closest('.delete-item-btn');

            if (assignBtn) {
                const itemEl = assignBtn.closest('.edit-item');
                const productId = parseInt(itemEl.dataset.id, 10);
                const listNumber = parseInt(assignBtn.dataset.list, 10);
                const product = getAllProducts().find(p => p.id === productId);

                if (product) {
                    if (!product.myList) product.myList = [];
                    const listIndex = product.myList.indexOf(listNumber);
                    if (listIndex > -1) {
                        product.myList.splice(listIndex, 1);
                    } else {
                        product.myList.push(listNumber);
                    }
                    renderEditView();
                }
            }

            if (deleteBtn) {
                const itemEl = deleteBtn.closest('.edit-item');
                const productId = parseInt(itemEl.dataset.id, 10);
                const product = getAllProducts().find(p => p.id === productId);

                if (product) {
                    product.liked = false;
                    product.likedTimestamp = null;
                    product.myList = [];
                    renderEditView();
                    updateLikedCountBadge();
                }
            }
        });
        
        saveButton.addEventListener('click', showQuickOrderView);

        // --- GLOBAL LISTENERS ---
        // (ê¸°ì¡´ ë¦¬ìŠ¤ë„ˆ... ìƒëµ)
        productSearchInput.addEventListener('input', (e) => {
            appState.searchTerm = e.target.value.trim();
            renderProducts();
        });

        orderButton.addEventListener('click', function() {
            if (Object.keys(appState.cart).length === 0) return;
            if (orderConfirmationContainer.classList.contains('hidden')) {
                showConfirmationView();
            } else {
                // ì´ alert ëŒ€ì‹  ì»¤ìŠ¤í…€ ëª¨ë‹¬ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
                alert('ì£¼ë¬¸ ì™„ë£Œ! (ì‹¤ì œ ì£¼ë¬¸ ë¡œì§ êµ¬í˜„ í•„ìš”)');
            }
        });

        homeNavBtn.addEventListener('click', e => { e.preventDefault(); showHomeView(); });
        quickOrderNavBtn.addEventListener('click', e => { e.preventDefault(); showQuickOrderView(); });
        logoHome.addEventListener('click', showHomeView);
        logoQuickOrder.addEventListener('click', showHomeView);
        editButton.addEventListener('click', showEditView);
        showSearchBtn.addEventListener('click', () => toggleSearchMode(!appState.isSearching));
        cancelSearchBtn.addEventListener('click', () => toggleSearchMode(false));

        // --- SCROLL LOGIC ---
        // (ê¸°ì¡´ í•¨ìˆ˜... ìƒëµ)
        let lastScrollY = window.scrollY;
        const subHeader = document.getElementById('sub-header');

        window.addEventListener('scroll', () => {
            if (appState.currentView !== 'quick-order' || !subHeader) return;
            const currentScrollY = window.scrollY;
            const threshold = 10;
            
            if (currentScrollY > lastScrollY && currentScrollY > (subHeader.offsetTop + subHeader.offsetHeight)) {
                subHeader.classList.add('sub-header-hidden');
            } else if (currentScrollY < lastScrollY) {
                subHeader.classList.remove('sub-header-hidden');
            }
            lastScrollY = currentScrollY <= 0 ? 0 : currentScrollY;
        }, { passive: true });


        // --- NEW: ONBOARDING EVENT LISTENERS (ì˜¨ë³´ë”© ë²„íŠ¼ ì´ë²¤íŠ¸) ---
        
        // í•˜ë‹¨ ì‹œíŠ¸ íŒì—…ì˜ ë²„íŠ¼
        onboardingCloseBtnTop.addEventListener('click', endOnboarding); // ìš°ìƒë‹¨ X ë²„íŠ¼
        onboardingWatchVideoBtn.addEventListener('click', showVideoGuide); // [30ì´ˆ ì˜ìƒ ê°€ì´ë“œ] ë²„íŠ¼
        onboardingStartTourBtn.addEventListener('click', showCoachMarks); // [ì§ì ‘ ë‘˜ëŸ¬ë³´ê¸°] ë²„íŠ¼
        
        // ë¹„ë””ì˜¤ ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼
        videoModalCloseBtn.addEventListener('click', endOnboarding);

        // ì½”ì¹˜ ë§ˆí¬ ë²„íŠ¼
        coachMarkNext1.addEventListener('click', () => {
            coachMark1.classList.remove('active');
            coachMark2.classList.add('active');
        });
        coachMarkNext2.addEventListener('click', () => {
            coachMark2.classList.remove('active');
            coachMark3.classList.add('active');
        });
        coachMarkDone.addEventListener('click', endOnboarding);
        // --- END NEW LISTENERS ---


        // --- INITIAL RENDER ---
        showHomeView();
    });
</script>

</body>
</html>
