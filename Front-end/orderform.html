<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>전용몰 주문서 (최종본)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        .payment-label {
            transition: all 0.2s ease-in-out;
        }
        input[type="radio"]:checked + .payment-label {
            border-color: #14b8a6;
            background-color: #f0fdfa;
            color: #0d9488;
            font-weight: 600;
            box-shadow: 0 0 0 2px #14b8a6;
        }
        .custom-checkbox:checked {
            background-color: #2dd4bf;
            border-color: #2dd4bf;
        }
        .custom-checkbox:checked::after {
            content: '✔';
            color: white;
            display: block;
            text-align: center;
            line-height: 1.25rem;
            font-size: 0.8rem;
        }
        .toggle-section {
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s ease-in-out;
            padding: 0;
            opacity: 0;
            margin-top: 0;
        }
        .toggle-section.show {
            max-height: 500px; /* 충분한 높이 */
            opacity: 1;
            margin-top: 0.5rem; /* mt-2 */
        }
    </style>
</head>
<body class="bg-gray-50">

    <div class="max-w-md mx-auto bg-white">
        <!-- 헤더 -->
        <header class="flex justify-between items-center p-4 border-b">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
            <h1 class="text-lg font-bold">주문서 작성</h1>
            <div class="w-6"></div>
        </header>

        <main class="p-4">
            <!-- 배송 정보 -->
            <section>
                <h2 class="text-base font-semibold">배송 정보</h2>
                <div class="mt-3 text-sm text-gray-700 p-4 border rounded-lg bg-gray-50/50">
                    <p class="font-bold">꽃놀이식당(김민준) <span class="text-teal-600 font-semibold">전용회원</span></p>
                    <p class="mt-1">010-1234-5678</p>
                    <p class="mt-1">(51496) 경남 창원시 성산구 가음정로 94, 상세주소</p>
                </div>
            </section>

            <hr class="my-6">

            <!-- 주문 상품 -->
            <section>
                <h2 class="text-base font-semibold mb-3">주문 상품</h2>
                <div class="border-t border-b">
                    <div class="space-y-2 p-3 text-sm">
                        <div class="flex items-center"><p class="flex-1 text-gray-800">양파 20KG</p><span class="w-10 text-center">1</span><span class="w-20 text-right font-medium">23,000원</span></div>
                        <div class="flex items-center"><p class="flex-1 text-gray-800">양배추_중_5입</p><span class="w-10 text-center">1</span><span class="w-20 text-right font-medium">12,000원</span></div>
                        <div class="flex items-center"><p class="flex-1 text-gray-800">감자왕왕_10kg</p><span class="w-10 text-center">1</span><span class="w-20 text-right font-medium">18,000원</span></div>
                        <div class="flex items-center"><p class="flex-1 text-gray-800">무우_상박스</p><span class="w-10 text-center">1</span><span class="w-20 text-right font-medium">15,000원</span></div>
                        <div class="flex items-center"><p class="flex-1 text-gray-800">흙쪽파(1kg)단</p><span class="w-10 text-center">1</span><span class="w-20 text-right font-medium">9,000원</span></div>
                    </div>
                </div>
                <div class="mt-4">
                    <label for="delivery-request-custom" class="text-sm font-medium text-gray-700">전하실 말씀</label>
                    <input type="text" id="delivery-request-custom" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2" placeholder="전하실 말씀을 입력해주세요.">
                </div>
            </section>
            
            <hr class="my-6">

            <!-- 품절상품 대체 배송 동의 -->
            <section>
                <div class="p-4 border rounded-lg bg-gray-50/50">
                    <div class="flex items-start">
                        <input id="substitute-agreement" type="checkbox" class="h-5 w-5 rounded border-gray-300 text-teal-600 focus:ring-teal-500 mt-1 custom-checkbox appearance-none" checked>
                        <div class="ml-3 text-sm">
                            <label for="substitute-agreement" class="font-medium text-gray-800">품절상품 대체 상품으로 배송 동의</label>
                            <ul class="mt-2 text-xs text-gray-600 list-disc list-inside space-y-1">
                                <li>품절 상품은 가장 유사한 대체상품으로 배송해 드립니다.</li>
                                <li>단가 차액은 예치금 충전 또는 추가 결제 요청드립니다.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <hr class="my-6">
            
            <!-- 결제 정보 -->
            <section>
                <h2 class="text-base font-semibold mb-3">결제 정보</h2>
                
                <!-- 결제 수단 -->
                <div>
                     <h3 class="text-sm font-medium text-gray-700 mb-2">결제 수단</h3>
                     <div class="grid grid-cols-2 gap-2">
                         <div>
                           <input type="radio" name="payment-method" id="pm-bank" value="bank" class="hidden" checked>
                           <label for="pm-bank" class="payment-label flex items-center justify-center p-3 border rounded-lg text-sm cursor-pointer">무통장입금</label>
                        </div>
                        <div>
                           <input type="radio" name="payment-method" id="pm-credit" value="credit" class="hidden">
                           <label for="pm-credit" class="payment-label flex items-center justify-center p-3 border rounded-lg text-sm cursor-pointer">신용 거래</label>
                        </div>
                    </div>
                </div>
                
                <!-- 신용 한도 (신용 거래 선택 시 노출) -->
                <div id="credit-info" class="toggle-section">
                    <div class="p-4 border rounded-lg bg-gray-50">
                        <h3 class="font-semibold text-gray-800">신용 한도</h3>
                        <div class="mt-3 space-y-2 text-sm">
                            <div class="flex justify-between"><span>총 한도</span><span id="total-credit-limit"></span></div>
                            <div class="flex justify-between"><span>사용 금액</span><span id="used-credit"></span></div>
                            <div class="flex justify-between text-teal-600"><span class="font-bold">잔여 한도</span><span id="available-credit" class="font-bold"></span></div>
                        </div>
                        <div class="mt-3 w-full bg-gray-200 rounded-full h-2.5"><div id="credit-usage-bar" class="bg-teal-500 h-2.5 rounded-full"></div></div>
                    </div>
                </div>

                <!-- 계좌 정보 (무통장입금 선택 시 노출) -->
                <div id="bank-info" class="toggle-section">
                    <div class="bg-gray-50 rounded-md border text-sm p-4 space-y-4">
                        <div>
                            <p class="font-medium text-gray-800">입금 계좌</p>
                            <div class="mt-2 flex justify-between items-center bg-white p-3 rounded-md">
                                <p class="text-gray-700">
                                    <span class="font-bold text-gray-800">우리은행 1002-123-456789</span>
                                    <span class="text-gray-500 ml-2">(예금주: 이무철)</span>
                                </p>
                                <button onclick="copyToClipboard()" class="bg-gray-200 hover:bg-gray-300 text-gray-700 text-xs font-bold py-2 px-3 rounded flex-shrink-0 ml-2">복사</button>
                            </div>
                        </div>

                        <div class="border-t pt-4 space-y-3">
                             <p class="font-medium text-gray-800">입금 정보 입력</p>
                             <div class="flex justify-between items-center">
                                <label for="depositor-name" class="text-sm text-gray-700 flex-shrink-0 pr-4">입금자명</label>
                                <input type="text" id="depositor-name" value="김민준" class="block w-full rounded-md border-gray-300 shadow-sm p-2 text-sm h-9">
                            </div>
                             <div class="flex justify-between items-center">
                                <label for="deposit-amount" class="text-sm text-gray-700 flex-shrink-0 pr-4">입금액</label>
                                <input type="text" id="deposit-amount" readonly class="block w-full rounded-md border-gray-300 shadow-sm p-2 text-sm h-9 bg-gray-100 text-right">
                                <span class="ml-2 text-gray-600">원</span>
                            </div>
                        </div>

                        <div class="border-t pt-4">
                            <button id="deposit-confirm-btn" class="w-full bg-teal-500 hover:bg-teal-600 text-white font-bold py-2.5 px-4 rounded-lg transition-colors">입금 확인 요청</button>
                            <p class="text-xs text-gray-500 mt-2 text-center">*입금 후 정보를 남겨주시면 더 빠른 처리가 가능합니다.</p>
                        </div>
                    </div>
                </div>
                <div id="copy-message" class="text-center text-sm text-teal-600 mt-2 h-5"></div>

                <!-- 잔액 부족 시 안내 메시지 -->
                <div id="payment-insufficient-notice" class="hidden mt-4 p-4 border rounded-lg bg-red-50 text-red-700 text-sm">
                    <h3 class="font-semibold">주문 불가</h3>
                    <p class="mt-1">신용 한도가 부족하여 주문을 진행할 수 없습니다.<br>관리자에게 문의해주세요.</p>
                </div>
            </section>
        </main>

        <footer class="sticky bottom-0 bg-white border-t p-4">
            <div id="footer-summary" class="space-y-2 text-sm mb-4">
                <!-- JS로 동적 생성 -->
            </div>
            
            <div class="flex items-center mb-3">
                <input id="agreement" type="checkbox" class="h-5 w-5 rounded border-gray-300 text-teal-600 focus:ring-teal-500 appearance-none custom-checkbox" checked>
                <label for="agreement" class="ml-2 block text-xs text-gray-700">주문 상품, 가격, 배송 정보를 확인했으며 구매에 동의합니다. (필수)</label>
            </div>
            
            <button id="payment-button" class="w-full bg-teal-500 hover:bg-teal-600 text-white font-bold py-3 px-4 rounded-lg transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed"></button>
        </footer>
    </div>

    <script>
        // --- 데이터 (서버에서 가져올 정보) ---
        const creditData = { totalLimit: 5000000, used: 1250000 };
        const orderTotal = 77000; 
        const shippingFee = 3000;
        const freeShippingThreshold = 50000;
        const bankAccount = '1002-123-456789';

        // --- UI 요소 ---
        const ui = {
            totalCreditLimit: document.getElementById('total-credit-limit'),
            usedCredit: document.getElementById('used-credit'),
            availableCredit: document.getElementById('available-credit'),
            creditUsageBar: document.getElementById('credit-usage-bar'),
            paymentInsufficientNotice: document.getElementById('payment-insufficient-notice'),
            footerSummary: document.getElementById('footer-summary'),
            paymentButton: document.getElementById('payment-button'),
            bankInfo: document.getElementById('bank-info'),
            creditInfo: document.getElementById('credit-info'),
            copyMessage: document.getElementById('copy-message'),
            depositAmount: document.getElementById('deposit-amount'),
        };

        document.addEventListener('DOMContentLoaded', () => {
            updateSummary();
            document.querySelectorAll('input[name="payment-method"]').forEach(radio => {
                radio.addEventListener('change', updateSummary);
            });
        });

        function formatCurrency(amount, includeSymbol = true) {
            const formatted = new Intl.NumberFormat('ko-KR').format(amount);
            return includeSymbol ? formatted + '원' : formatted;
        }

        function updateSummary() {
            const currentShippingFee = orderTotal < freeShippingThreshold ? shippingFee : 0;
            const finalAmount = orderTotal + currentShippingFee;
            const availableCredit = creditData.totalLimit - creditData.used;
            const usagePercentage = (creditData.used / creditData.totalLimit) * 100;
            const selectedPayment = document.querySelector('input[name="payment-method"]:checked').value;

            // 신용 한도 데이터 업데이트
            ui.totalCreditLimit.textContent = formatCurrency(creditData.totalLimit);
            ui.usedCredit.textContent = formatCurrency(creditData.used);
            ui.availableCredit.textContent = formatCurrency(availableCredit);
            ui.creditUsageBar.style.width = `${usagePercentage}%`;

            // 입금액 필드 업데이트
            ui.depositAmount.value = formatCurrency(finalAmount, false);

            // 결제 수단에 따른 UI 토글
            ui.bankInfo.classList.toggle('show', selectedPayment === 'bank');
            ui.creditInfo.classList.toggle('show', selectedPayment === 'credit');

            // 하단 결제 요약 HTML 생성
            let summaryHtml = `<div class="flex justify-between"><span class="text-gray-600">총 상품금액</span><span>${formatCurrency(orderTotal)}</span></div><div class="flex justify-between"><span class="text-gray-600">배송비</span><span>${formatCurrency(currentShippingFee)}</span></div><hr class="my-2 !m-0">`;
            
            if (selectedPayment === 'credit') {
                // 신용 거래 선택 시
                if (finalAmount <= availableCredit) {
                    // 주문 가능
                    ui.paymentInsufficientNotice.classList.add('hidden');
                    ui.paymentButton.disabled = false;
                    const remainingAfter = availableCredit - finalAmount;
                    summaryHtml += `<div class="flex justify-between text-base font-bold pt-2 text-teal-700"><span>총 주문금액</span><span>${formatCurrency(finalAmount)}</span></div><div class="flex justify-between text-xs text-gray-500 mt-1"><span>결제 후 잔여 한도</span><span>${formatCurrency(remainingAfter)}</span></div>`;
                    ui.paymentButton.textContent = `${formatCurrency(finalAmount)} 결제하기`;
                } else {
                    // 주문 불가 (잔액 부족)
                    ui.paymentInsufficientNotice.classList.remove('hidden');
                    ui.paymentButton.disabled = true;
                    summaryHtml += `<div class="flex justify-between text-base font-bold pt-2"><span>최종 결제 금액</span><span class="text-red-600">${formatCurrency(finalAmount)}</span></div>`;
                    summaryHtml += `<div class="flex justify-between text-xs text-red-500 mt-1"><span>(신용 한도 ${formatCurrency(finalAmount - availableCredit)} 부족)</span></div>`;
                    ui.paymentButton.textContent = '신용 한도가 부족합니다';
                }
            } else {
                // 무통장입금 선택 시
                ui.paymentInsufficientNotice.classList.add('hidden');
                ui.paymentButton.disabled = false;
                summaryHtml += `<div class="flex justify-between text-base font-bold pt-2"><span>최종 결제 금액</span><span class="text-red-600">${formatCurrency(finalAmount)}</span></div>`;
                ui.paymentButton.textContent = `${formatCurrency(finalAmount)} 결제하기`;
            }
            
            ui.footerSummary.innerHTML = summaryHtml;
        }

        function copyToClipboard() {
            const tempInput = document.createElement('input');
            tempInput.value = bankAccount;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand('copy');
            document.body.removeChild(tempInput);

            ui.copyMessage.textContent = '계좌번호가 복사되었습니다.';
            setTimeout(() => { ui.copyMessage.textContent = ''; }, 2000);
        }
    </script>
</body>
</html>

