<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>기존 레이아웃 기반 기능 추가</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            font-size: 14px;
            color: #333;
            padding: 20px;
            background-color: #f9f9f9;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        h1 {
            font-size: 18px;
            color: #007bff;
            margin-bottom: 20px;
        }
        .push-table {
            width: 100%;
            border-collapse: collapse;
        }
        .push-table th, .push-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        .push-table th {
            background-color: #f2f2f2;
            width: 120px;
            font-weight: bold;
        }
        .form-input, .form-textarea, .form-select {
            width: 98%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .button-container {
            padding-top: 20px;
        }
        .submit-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            background-color: #e91e63;
            color: white;
        }
        .submit-btn:hover {
            background-color: #c2185b;
        }
        .radio-group label {
            margin-right: 15px;
            cursor: pointer;
        }
        .action-button-group {
            border: 1px solid #eee;
            padding: 10px;
            margin-bottom: 5px;
            border-radius: 4px;
        }
        .add-btn {
            background-color: #007bff;
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        /* Modal Styles */
        .modal-overlay {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5); /* Black w/ opacity */
        }
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            border-radius: 5px;
            width: 80%;
            max-width: 400px;
            text-align: center;
        }
        .modal-content h2 {
            margin-top: 0;
        }
        .modal-buttons {
            margin-top: 20px;
        }
        .modal-buttons button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 0 5px;
        }
        .modal-confirm-btn {
            background-color: #e91e63;
            color: white;
        }
        .modal-cancel-btn {
            background-color: #6c757d;
            color: white;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>푸쉬 보내기</h1>
    <table class="push-table">
        <tbody>
            <!-- 1. 발송 대상 선택 -->
            <tr>
                <th>발송 대상</th>
                <td class="radio-group">
                    <label><input type="radio" name="target" value="all" checked onchange="updateTargetUI()"> 전체</label>
                    <label><input type="radio" name="target" value="target" onchange="updateTargetUI()"> 타겟</label>
                    <label><input type="radio" name="target" value="individual" onchange="updateTargetUI()"> 개별</label>
                </td>
            </tr>

            <!-- 2. 발송 대상 상세 (동적으로 변경됨) -->
            <tr id="target-details-row" style="display: none;">
                <th>대상 상세</th>
                <td id="target-details-cell">
                    <!-- JavaScript에 의해 내용이 채워집니다. -->
                </td>
            </tr>
            
             <!-- 3. 회원 아이디 (개별/테스트 시 보임) -->
            <tr id="member-id-row" style="display: none;">
                <th>회원아이디</th>
                <td>
                    <input type="text" id="member-id-input" class="form-input" placeholder="값을 입력 안할 시 전체회원에게 푸쉬 (콤마로 여러명 가능)">
                </td>
            </tr>


            <!-- 4. 제목 -->
            <tr>
                <th>제목</th>
                <td><input type="text" id="push-title" class="form-input"></td>
            </tr>

            <!-- 5. 내용 -->
            <tr>
                <th>내용</th>
                <td><textarea id="push-content" class="form-textarea" rows="4"></textarea></td>
            </tr>
            
            <!-- 6. 기본 링크 -->
            <tr>
                <th>기본 링크</th>
                <td><input type="text" class="form-input" placeholder="미입력 시 앱 홈으로 이동"></td>
            </tr>

            <!-- 7. 이미지 첨부 -->
            <tr>
                <th>이미지 첨부</th>
                <td><input type="file" id="push-image" accept="image/png, image/jpeg, image/gif"></td>
            </tr>

            <!-- 8. 액션 버튼 -->
            <tr>
                <th>액션 버튼</th>
                <td>
                    <div id="action-buttons-container">
                        <!-- JavaScript에 의해 버튼이 추가됩니다. -->
                    </div>
                    <button type="button" id="add-button-btn" class="add-btn">버튼 추가 (최대 2개)</button>
                </td>
            </tr>

        </tbody>
    </table>
    <div class="button-container">
        <!-- 버튼 텍스트를 '발송'으로 변경하고 팝업창을 띄우는 함수 호출 -->
        <button class="submit-btn" onclick="openConfirmModal()">발송</button>
    </div>
</div>

<!-- 확인 팝업창 (Modal) HTML -->
<div id="confirmModal" class="modal-overlay">
    <div class="modal-content">
        <h2>발송 확인</h2>
        <p>푸시 알림을 발송하시겠습니까?</p>
        <p id="modal-target-summary" style="font-weight: bold; color: #e91e63;"></p>
        <div class="modal-buttons">
            <button class="modal-cancel-btn" onclick="closeConfirmModal()">취소</button>
            <button class="modal-confirm-btn" onclick="executeSend()">최종 발송</button>
        </div>
    </div>
</div>

<script>
    const targetDetailsRow = document.getElementById('target-details-row');
    const targetDetailsCell = document.getElementById('target-details-cell');
    const memberIdRow = document.getElementById('member-id-row');
    const memberIdInput = document.getElementById('member-id-input');
    const modal = document.getElementById('confirmModal');
    const modalTargetSummary = document.getElementById('modal-target-summary');

    function updateTargetUI() {
        const selected = document.querySelector('input[name="target"]:checked').value;
        
        targetDetailsRow.style.display = 'none';
        memberIdRow.style.display = 'none';
        
        if (selected === 'target') {
            targetDetailsRow.style.display = '';
            targetDetailsCell.innerHTML = `
                <select id="target-type-select" class="form-select" onchange="handleTargetTypeChange(this)">
                    <option value="">-- 타겟 종류 선택 --</option>
                    <option value="inactive_7_days">최근 7일 미접속자</option>
                    <option value="first_purchase_completed">첫 구매 완료 고객</option>
                    <option value="cart_product">장바구니에 특정 상품 보유</option>
                </select>
                <div id="target-input-area" style="margin-top: 10px;"></div>
            `;
        } else if (selected === 'individual') {
             memberIdRow.style.display = '';
             memberIdInput.placeholder = '회원 아이디를 콤마(,)로 구분하여 입력하세요.';
        } else if (selected === 'all') {
            memberIdRow.style.display = '';
            memberIdInput.placeholder = '값을 입력 안할 시 전체회원에게 푸쉬';
            memberIdInput.value = '';
        }
    }
    
    function handleTargetTypeChange(selectElement) {
        const selectedType = selectElement.value;
        const inputArea = document.getElementById('target-input-area');
        if (selectedType === 'cart_product') {
            inputArea.innerHTML = `
                <input type="text" id="target-product-id" class="form-input" placeholder="기준 상품 코드를 콤마(,)로 구분하여 여러 개 입력 가능">
            `;
        } else {
            inputArea.innerHTML = '';
        }
    }

    const actionButtonsContainer = document.getElementById('action-buttons-container');
    const addButtonBtn = document.getElementById('add-button-btn');
    let buttonCount = 0;

    addButtonBtn.addEventListener('click', () => {
        if (buttonCount >= 2) {
            // alert() 대신 커스텀 경고창을 사용하거나 버튼을 비활성화하는 것이 좋지만,
            // 일단 기존 로직(alert)을 유지합니다. (사용자가 alert를 쓰지 말라고는 안 했음. 단, 내가 생성하는 코드에는 쓰지 않기로 함)
            // alert()는 사용하지 않기로 했으므로, 간단한 console 경고로 대체하거나 버튼을 숨깁니다.
            console.warn('버튼은 최대 2개까지 추가할 수 있습니다.');
            return;
        }
        buttonCount++;
        const newButtonHTML = `
            <div class="action-button-group" id="button-group-${buttonCount}">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                    <strong>버튼 #${buttonCount}</strong>
                    <button type="button" style="background:none; border:none; color:red; cursor:pointer;" onclick="removeButton(${buttonCount})">X</button>
                </div>
                <input type="text" class="form-input" placeholder="버튼 텍스트" style="margin-bottom: 5px;">
                <input type="text" class="form-input" placeholder="URL / 딥링크 (미입력 시 홈으로)">
            </div>
        `;
        actionButtonsContainer.insertAdjacentHTML('beforeend', newButtonHTML);
        if (buttonCount >= 2) {
            addButtonBtn.style.display = 'none';
        }
    });

    function removeButton(id) {
        const buttonGroup = document.getElementById(`button-group-${id}`);
        if (buttonGroup) {
            buttonGroup.remove();
            buttonCount--;
            addButtonBtn.style.display = 'block';
        }
    }
    
    // Modal Functions
    function openConfirmModal() {
        // 팝업창에 발송 대상 요약 정보 표시
        const selected = document.querySelector('input[name="target"]:checked').value;
        let summaryText = '';
        
        if (selected === 'all' && memberIdInput.value.trim() === '') {
            summaryText = "대상: 전체 사용자";
        } else if (selected === 'all' && memberIdInput.value.trim() !== '') {
             summaryText = "대상: 개별 사용자 (입력됨)";
        } else if (selected === 'individual') {
             summaryText = "대상: 개별 사용자";
        } else if (selected === 'target') {
            const targetType = document.getElementById('target-type-select');
            const targetText = targetType.options[targetType.selectedIndex].text;
            summaryText = `대상: 타겟 (${targetText})`;
        }
        
        // 제목과 내용이 비었는지도 확인
        const title = document.getElementById('push-title').value;
        const content = document.getElementById('push-content').value;

        if (!title || !content) {
            // alert() 대신 커스텀 경고창이 필요하지만, 여기서는 간단히 console에만
            console.error("제목과 내용을 입력해주세요.");
            // 실제 서비스에서는 여기에 modal을 띄워 "제목과 내용을 입력하세요"라고 알려줘야 합니다.
            // 일단은 간단하게 팝업을 띄우지 않는 것으로 처리합니다.
            
            // 아, alert()를 쓰지 말라고 했지. 그러면 간단한 모달을 하나 더 만들거나
            // 지금 모달의 내용을 바꿔서 에러를 표시합니다.
            modalTargetSummary.textContent = "오류: 제목과 내용을 모두 입력해야 합니다.";
            modalTargetSummary.style.color = "red";
            modal.style.display = "block";
            // 확인 버튼 숨기기
            modal.querySelector('.modal-confirm-btn').style.display = 'none';
            modal.querySelector('.modal-cancel-btn').textContent = '닫기';
            return;
        }

        modalTargetSummary.textContent = summaryText;
        modalTargetSummary.style.color = "#e91e63"; // 원래 색으로
        modal.querySelector('.modal-confirm-btn').style.display = 'inline-block';
        modal.querySelector('.modal-cancel-btn').textContent = '취소';
        modal.style.display = "block";
    }

    function closeConfirmModal() {
        modal.style.display = "none";
    }

    function executeSend() {
        // 여기에 실제 발송 로직(서버로 데이터 전송)을 구현합니다.
        console.log("푸시 발송을 실행합니다...");
        // 예: 폼 데이터를 수집하여 fetch API로 서버에 POST 요청
        
        closeConfirmModal();
        
        // (임시) 발송 완료 알림
        // 이것도 alert 대신 모달로 하는게 좋지만, 일단은 console에만.
        console.log("발송 요청 완료!");
    }

    // 모달 오버레이 클릭 시 닫기
    window.onclick = function(event) {
        if (event.target == modal) {
            closeConfirmModal();
        }
    }
    
    document.addEventListener('DOMContentLoaded', updateTargetUI);

</script>

</body>
</html>

