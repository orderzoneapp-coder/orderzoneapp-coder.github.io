<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>기존 레이아웃 기반 기능 추가</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            font-size: 14px;
            color: #333;
            padding: 20px;
            background-color: #f9f9f9;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        h1 {
            font-size: 18px;
            color: #007bff;
            margin-bottom: 20px;
        }
        .push-table {
            width: 100%;
            border-collapse: collapse;
        }
        .push-table th, .push-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        .push-table th {
            background-color: #f2f2f2;
            width: 120px;
            font-weight: bold;
        }
        .form-input, .form-textarea, .form-select {
            width: 98%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .submit-btn {
            background-color: #e91e63;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        .submit-btn:hover {
            background-color: #c2185b;
        }
        .radio-group label {
            margin-right: 15px;
            cursor: pointer;
        }
        .action-button-group {
            border: 1px solid #eee;
            padding: 10px;
            margin-bottom: 5px;
            border-radius: 4px;
        }
        .add-btn {
            background-color: #007bff;
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none; /* Hidden by default */
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            width: 400px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        .modal-header {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .modal-body {
            margin-bottom: 20px;
        }
        .modal-footer {
            text-align: right;
        }
        .modal-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
        }
        .modal-btn-cancel {
            background-color: #f0f0f0;
        }
        .modal-btn-confirm {
            background-color: #e91e63;
            color: white;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>푸쉬 보내기</h1>
    <table class="push-table">
        <tbody>
            <!-- 1. 발송 대상 선택 -->
            <tr>
                <th>발송 대상</th>
                <td class="radio-group">
                    <label><input type="radio" name="target" value="all" checked onchange="updateTargetUI()"> 전체</label>
                    <label><input type="radio" name="target" value="target" onchange="updateTargetUI()"> 타겟</label>
                    <label><input type="radio" name="target" value="individual" onchange="updateTargetUI()"> 개별</label>
                </td>
            </tr>

            <!-- 2. 발송 대상 상세 (동적으로 변경됨) -->
            <tr id="target-details-row" style="display: none;">
                <th>대상 상세</th>
                <td id="target-details-cell">
                    <!-- JavaScript에 의해 내용이 채워집니다. -->
                </td>
            </tr>
            
             <!-- 3. 회원 아이디 (개별/전체 시 보임) -->
            <tr id="member-id-row" style="display: none;">
                <th>회원아이디</th>
                <td>
                    <input type="text" id="member-id-input" class="form-input" placeholder="값을 입력 안할 시 전체회원에게 푸쉬 (콤마로 여러명 가능)">
                </td>
            </tr>


            <!-- 4. 제목 -->
            <tr>
                <th>제목</th>
                <td><input type="text" class="form-input"></td>
            </tr>

            <!-- 5. 내용 -->
            <tr>
                <th>내용</th>
                <td><textarea class="form-textarea" rows="4"></textarea></td>
            </tr>
            
            <!-- 6. 기본 링크 -->
            <tr>
                <th>기본 링크</th>
                <td><input type="text" class="form-input" placeholder="미입력 시 앱 홈으로 이동"></td>
            </tr>

            <!-- 7. 이미지 첨부 -->
            <tr>
                <th>이미지 첨부</th>
                <td><input type="file" accept="image/png, image/jpeg, image/gif"></td>
            </tr>

            <!-- 8. 액션 버튼 -->
            <tr>
                <th>액션 버튼</th>
                <td>
                    <div id="action-buttons-container">
                        <!-- JavaScript에 의해 버튼이 추가됩니다. -->
                    </div>
                    <button type="button" id="add-button-btn" class="add-btn">버튼 추가 (최대 2개)</button>
                </td>
            </tr>

        </tbody>
    </table>
    <div style="text-align: left; padding-top: 20px;">
        <button class="submit-btn" id="send-push-btn">발송</button>
    </div>
</div>

<!-- Confirmation Modal -->
<div id="confirmation-modal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">발송 확인</div>
        <div class="modal-body">
            <p>푸시 알림을 발송하시겠습니까?</p>
            <p style="font-size: 12px; color: #555; margin-top: 10px;">
                (발송 대상, 내용, 링크를 다시 한번 확인해주세요.)
            </p>
        </div>
        <div class="modal-footer">
            <button id="cancel-btn" class="modal-btn modal-btn-cancel">취소</button>
            <button id="confirm-send-btn" class="modal-btn modal-btn-confirm">최종 발송</button>
        </div>
    </div>
</div>

<script>
    const targetDetailsRow = document.getElementById('target-details-row');
    const targetDetailsCell = document.getElementById('target-details-cell');
    const memberIdRow = document.getElementById('member-id-row');
    const memberIdInput = document.getElementById('member-id-input');

    function updateTargetUI() {
        const selected = document.querySelector('input[name="target"]:checked').value;
        
        targetDetailsRow.style.display = 'none';
        memberIdRow.style.display = 'none';
        
        if (selected === 'target') {
            targetDetailsRow.style.display = '';
            targetDetailsCell.innerHTML = `
                <select id="target-type-select" class="form-select" onchange="handleTargetTypeChange(this)">
                    <option value="">-- 타겟 종류 선택 --</option>
                    <option value="inactive_7_days">최근 7일 미접속자</option>
                    <option value="first_purchase_completed">첫 구매 완료 고객</option>
                    <!-- <option value="cart_category">장바구니에 특정 카테고리 상품 보유</option> -->
                    <option value="wishlist_category">찜에 특정 카테고리 상품 보유</option>
                </select>
                <div id="target-input-area" style="margin-top: 10px;"></div>
            `;
        } else if (selected === 'individual') {
             memberIdRow.style.display = '';
             memberIdInput.placeholder = '회원 아이디를 콤마(,)로 구분하여 입력하세요.';
        } else if (selected === 'all') {
            memberIdRow.style.display = '';
            memberIdInput.placeholder = '값을 입력 안할 시 전체회원에게 푸쉬';
            memberIdInput.value = ''; 
        }
    }
    
    function handleTargetTypeChange(selectElement) {
        const selectedType = selectElement.value;
        const inputArea = document.getElementById('target-input-area');
        
        // '찜'을 선택한 경우 카테고리 셀렉트 박스를 보여줌
        if (selectedType === 'wishlist_category') {
            const labelText = '찜';
            inputArea.innerHTML = `
                <label for="target-category-select" class="form-label" style="margin-top: 5px;">3차 카테고리 선택</label>
                <select id="target-category-select" class="form-select">
                    <option value="">-- 카테고리 선택 --</option>
                    <optgroup label="야채/채소">
                        <option value="cat_radish">뿌리채소 > 무우</option>
                        <option value="cat_cabbage">잎채소 > 양배추</option>
                        <option value="cat_onion">향신채소 > 양파</option>
                    </optgroup>
                    <optgroup label="육류/정육">
                        <option value="cat_beef_sirloin">소고기 > 등심</option>
                        <option value="cat_pork_belly">돼지고기 > 삼겹살</option>
                        <option value="cat_chicken_breast">닭고기 > 닭가슴살</option>
                    </optgroup>
                    <optgroup label="수산/해산물">
                        <option value="cat_mackerel">생선 > 고등어</option>
                        <option value="cat_squid">해산물 > 오징어</option>
                        <option value="cat_shrimp">해산물 > 새우</option>
                    </optgroup>
                    <!-- 실제 3차 카테고리 목록은 여기에 채워져야 합니다. -->
                </select>
                <p style="font-size: 12px; color: #555; margin-top: 5px;">
                    이 카테고리의 상품을 ${labelText}에 담은 모든 사용자에게 푸시가 발송됩니다.
                </p>
            `;
        } else {
            // '7일 미접속' 등 다른 옵션은 추가 입력창이 필요 없음
            inputArea.innerHTML = '';
        }
    }

    // Action Button Management
    const actionButtonsContainer = document.getElementById('action-buttons-container');
    const addButtonBtn = document.getElementById('add-button-btn');
    let buttonCount = 0;

    addButtonBtn.addEventListener('click', () => {
        if (buttonCount >= 2) {
            alert('버튼은 최대 2개까지 추가할 수 있습니다.');
            return;
        }
        buttonCount++;
        const newButtonHTML = `
            <div class="action-button-group" id="button-group-${buttonCount}">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                    <strong>버튼 #${buttonCount}</strong>
                    <button type="button" style="background:none; border:none; color:red; cursor:pointer;" onclick="removeButton(${buttonCount})">X</button>
                </div>
                <input type="text" class="form-input" placeholder="버튼 텍스트" style="margin-bottom: 5px;">
                <input type="text" class="form-input" placeholder="URL / 딥링크 (미입력 시 홈으로)">
            </div>
        `;
        actionButtonsContainer.insertAdjacentHTML('beforeend', newButtonHTML);
        if (buttonCount >= 2) {
            addButtonBtn.style.display = 'none';
        }
    });

    function removeButton(id) {
        const buttonGroup = document.getElementById(`button-group-${id}`);
        if (buttonGroup) {
            buttonGroup.remove();
            buttonCount--;
            addButtonBtn.style.display = 'block';
        }
    }
    
    // Modal Handling
    const modal = document.getElementById('confirmation-modal');
    const sendBtn = document.getElementById('send-push-btn');
    const cancelBtn = document.getElementById('cancel-btn');
    const confirmSendBtn = document.getElementById('confirm-send-btn');

    sendBtn.addEventListener('click', () => {
        modal.style.display = 'flex';
    });

    cancelBtn.addEventListener('click', () => {
        modal.style.display = 'none';
    });

    confirmSendBtn.addEventListener('click', () => {
        // 실제 발송 로직을 여기에 추가합니다.
        // 예: sendPushNotification();
        console.log('푸시 발송 실행!');
        modal.style.display = 'none';
        alert('푸시 발송이 요청되었습니다.'); // (실제로는 alert 대신 성공 메시지 UI를 띄우는 것이 좋습니다)
    });

    // 팝업 외부 클릭 시 닫기
    window.addEventListener('click', (event) => {
        if (event.target == modal) {
            modal.style.display = 'none';
        }
    });
    
    // Initial UI setup
    document.addEventListener('DOMContentLoaded', updateTargetUI);

</script>

</body>
</html>


